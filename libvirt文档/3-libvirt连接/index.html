<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>3 libvirt连接 | watson Lu&#39;blogs</title>
  <meta name="description" content="3 连接在libvirt中，连接是系统中每个操作和对象的基础。任何希望与libvirt交互的实体，无论是virsh、virt-manager，还是使用libvirt库的程序，都需要首先获得与目标主机上libvirt守护进程的连接。连接不仅描述了代理希望交互的虚拟化技术类型（如qemu、xen、uml等），还描述了连接到该资源所需的任何认证方法。 3.1 概述libvirt 代理必须做的第一件事就是">
<meta property="og:type" content="article">
<meta property="og:title" content="3 libvirt连接">
<meta property="og:url" content="https://watsonlu6.github.io/libvirt%E6%96%87%E6%A1%A3/3-libvirt%E8%BF%9E%E6%8E%A5/index.html">
<meta property="og:site_name" content="watson&#39;blogs">
<meta property="og:description" content="3 连接在libvirt中，连接是系统中每个操作和对象的基础。任何希望与libvirt交互的实体，无论是virsh、virt-manager，还是使用libvirt库的程序，都需要首先获得与目标主机上libvirt守护进程的连接。连接不仅描述了代理希望交互的虚拟化技术类型（如qemu、xen、uml等），还描述了连接到该资源所需的任何认证方法。 3.1 概述libvirt 代理必须做的第一件事就是">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-03-03T07:50:26.000Z">
<meta property="article:modified_time" content="2025-03-15T08:00:25.244Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="云计算">
<meta property="article:tag" content="libvirt">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="https://watsonlu6.github.io/libvirt%E6%96%87%E6%A1%A3/3-libvirt%E8%BF%9E%E6%8E%A5/index.html">
  
    <link rel="alternate" href="/atom.xml" title="watson&#39;blogs" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 7.3.0"></head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/watsonLu6/" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">watson</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">Cloud computing development engineer</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> BeiJing, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav ">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">标签</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">项目</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">关于</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/watsonLu6/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://weibo.com" target="_blank" title="Weibo" data-toggle=tooltip data-placement=top><i class="icon icon-weibo"></i></a></li>
        
        <li><a href="https://twitter.com" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
        <li><a href="https://www.behance.net" target="_blank" title="Behance" data-toggle=tooltip data-placement=top><i class="icon icon-behance"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>欢迎交流与分享经验!</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E7%94%9F%E6%B4%BB/">个人生活</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%91%E5%AD%98%E5%82%A8/">云存储</a><span class="category-list-count">29</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%91%E5%AD%98%E5%82%A8/Ceph/">Ceph</a><span class="category-list-count">24</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%91%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8%E5%9F%BA%E7%A1%80/">存储基础</a><span class="category-list-count">5</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a><span class="category-list-count">12</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/libvirt/">libvirt</a><span class="category-list-count">12</span></li></ul></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ceph/" rel="tag">Ceph</a><span class="tag-list-count">24</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/libvirt/" rel="tag">libvirt</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AA%E4%BA%BA%E7%94%9F%E6%B4%BB/" rel="tag">个人生活</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%91%E5%AD%98%E5%82%A8/" rel="tag">云存储</a><span class="tag-list-count">29</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" rel="tag">云计算</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%98%E5%82%A8%E5%9F%BA%E7%A1%80/" rel="tag">存储基础</a><span class="tag-list-count">5</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签云</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/Ceph/" style="font-size: 13.75px;">Ceph</a> <a href="/tags/libvirt/" style="font-size: 13.5px;">libvirt</a> <a href="/tags/%E4%B8%AA%E4%BA%BA%E7%94%9F%E6%B4%BB/" style="font-size: 13px;">个人生活</a> <a href="/tags/%E4%BA%91%E5%AD%98%E5%82%A8/" style="font-size: 14px;">云存储</a> <a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" style="font-size: 13.5px;">云计算</a> <a href="/tags/%E5%AD%98%E5%82%A8%E5%9F%BA%E7%A1%80/" style="font-size: 13.25px;">存储基础</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">三月 2024</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">十月 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">九月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">八月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">二月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">十一月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">七月 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a><span class="archive-list-count">5</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a><i class="icon icon-angle-right"></i><a class="category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/libvirt/">libvirt</a>
              </p>
              <p class="item-title">
                <a href="/libvirt%E6%96%87%E6%A1%A3/12-libvirt%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B/" class="title">12 libvirt使用示例</a>
              </p>
              <p class="item-date">
                <time datetime="2024-03-12T07:50:26.000Z" itemprop="datePublished">2024-03-12</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a><i class="icon icon-angle-right"></i><a class="category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/libvirt/">libvirt</a>
              </p>
              <p class="item-title">
                <a href="/libvirt%E6%96%87%E6%A1%A3/11-libvirt%E8%B0%83%E8%AF%95%E4%B8%8E%E6%97%A5%E5%BF%97/" class="title">11 libvirt调试与日志</a>
              </p>
              <p class="item-date">
                <time datetime="2024-03-11T07:50:26.000Z" itemprop="datePublished">2024-03-11</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a><i class="icon icon-angle-right"></i><a class="category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/libvirt/">libvirt</a>
              </p>
              <p class="item-title">
                <a href="/libvirt%E6%96%87%E6%A1%A3/10-libvirt%E5%AE%89%E5%85%A8%E6%A8%A1%E5%BC%8F/" class="title">10 libvirt安全模式</a>
              </p>
              <p class="item-date">
                <time datetime="2024-03-10T07:50:26.000Z" itemprop="datePublished">2024-03-10</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a><i class="icon icon-angle-right"></i><a class="category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/libvirt/">libvirt</a>
              </p>
              <p class="item-title">
                <a href="/libvirt%E6%96%87%E6%A1%A3/9-libvirt%E4%BA%8B%E4%BB%B6%E5%92%8C%E8%AE%A1%E6%97%B6%E5%99%A8%E5%A4%84%E7%90%86/" class="title">9 libvirt事件和计时器处理</a>
              </p>
              <p class="item-date">
                <time datetime="2024-03-09T07:50:26.000Z" itemprop="datePublished">2024-03-09</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a><i class="icon icon-angle-right"></i><a class="category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/libvirt/">libvirt</a>
              </p>
              <p class="item-title">
                <a href="/libvirt%E6%96%87%E6%A1%A3/8-libvirt%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/" class="title">8 libvirt错误处理</a>
              </p>
              <p class="item-date">
                <time datetime="2024-03-08T07:50:26.000Z" itemprop="datePublished">2024-03-08</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<main class="main" role="main">
  <div class="content">
  <article id="post-libvirt文档/3-libvirt连接" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      3 libvirt连接
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/libvirt%E6%96%87%E6%A1%A3/3-libvirt%E8%BF%9E%E6%8E%A5/" class="article-date">
	  <time datetime="2024-03-03T07:50:26.000Z" itemprop="datePublished">2024-03-03</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a>►<a class="article-category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/libvirt/">libvirt</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/libvirt/" rel="tag">libvirt</a>, <a class="article-tag-link-link" href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" rel="tag">云计算</a>
  </span>


        

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/libvirt%E6%96%87%E6%A1%A3/3-libvirt%E8%BF%9E%E6%8E%A5/#comments" class="article-comment-link">评论</a></span>
        
      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h1 id="3-连接"><a href="#3-连接" class="headerlink" title="3 连接"></a>3 连接</h1><p>在libvirt中，连接是系统中每个操作和对象的基础。任何希望与libvirt交互的实体，无论是virsh、virt-manager，还是使用libvirt库的程序，都需要首先获得与目标主机上libvirt守护进程的连接。连接不仅描述了代理希望交互的虚拟化技术类型（如qemu、xen、uml等），还描述了连接到该资源所需的任何认证方法。</p>
<h2 id="3-1-概述"><a href="#3-1-概述" class="headerlink" title="3.1 概述"></a>3.1 概述</h2><p>libvirt 代理必须做的第一件事就是调用 <strong>virInitialize</strong> 函数或 Python libvirt 连接函数之一来获取 <strong>virConnect</strong> 类的实例。该实例将在后续操作中使用。Python libvirt 模块为连接到资源提供了 3 个不同的函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">conn = libvirt.<span class="built_in">open</span>(name)</span><br><span class="line">conn = libvirt.openAuth(uri, auth, flags)</span><br><span class="line">conn = libvirt.openReadOnly(name)</span><br></pre></td></tr></table></figure>

<p>在这三种情况下，都有一个名为 <code>name</code> 的参数，实际上指的是要连接的 hypervisor 的 URI。前面的 <em>第 2.2 节 “驱动程序模型 “</em> 和 <em>第 3.2.2 节 “远程 URI “</em> 详细介绍了可接受的各种 URI 格式。如果 URI 为 <code>None</code>，那么 libvirt 将应用一些启发式算法并探测适合的 hypervisor 驱动程序。虽然这对于开发人员进行临时测试可能很方便，但强烈建议应用程序不要依赖探测逻辑，因为它可能随时更改。应用程序应始终通过提供 URI 显式请求所需的 hypervisor 连接。</p>
<p>上述三种方法的区别在于它们进行身份验证的方式及其提供的授权级别。</p>
<h3 id="3-1-1-Open-函数"><a href="#3-1-1-Open-函数" class="headerlink" title="3.1.1 Open 函数"></a>3.1.1 Open 函数</h3><p><strong>open</strong> 函数将尝试为完全读写访问打开一个连接。该函数不允许提供身份验证回调，因此只有在可以根据应用程序的凭证进行身份验证的连接上才会成功。</p>
<p><strong>例 3.1. 使用 open</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-1.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>上述示例打开了与系统 qemu 管理程序驱动程序的读写连接，检查是否成功，如果成功则关闭连接。有关 libvirt URI 的更多信息，请参阅 *第 3.2 节 “URl 格式”*。</p>
<h3 id="3-1-2-openReadOnly"><a href="#3-1-2-openReadOnly" class="headerlink" title="3.1.2 openReadOnly"></a>3.1.2 openReadOnly</h3><p><strong>openReadOnly</strong> 函数将尝试为只读访问打开一个连接。这种连接只允许调用一组受限制的方法，通常用于监控不允许更改的应用程序。与 <strong>open</strong> 方法一样，该方法不支持身份验证回调，因此需要依赖凭证。</p>
<p><strong>例 3.2. 使用 openReadOnly</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-2.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.openReadOnly(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>上述示例打开了与系统 qemu 管理程序驱动程序的只读连接，检查是否成功，如果成功则关闭连接。有关 libvirt URI 的更多信息，请参阅 *第 3.2 节 “URl 格式”*。</p>
<h3 id="3-1-3-openAuth"><a href="#3-1-3-openAuth" class="headerlink" title="3.1.3 openAuth"></a>3.1.3 openAuth</h3><p><strong>openAuth</strong> 函数是最灵活的函数，实际上取代了前两个函数。它需要一个额外的参数，提供一个 Python <strong>列表</strong>，其中包含客户端应用程序的身份验证凭据。如果需要，flags 参数允许应用程序使用 <em>VIR_cONNEcT_RO</em> 标志请求只读连接。下面是一个使用 <strong>openAuth</strong> 和用户名与密码凭据的简单 Python 程序示例。与 <strong>open 方法</strong>一样，该方法没有身份验证回调范围，因此依赖于凭据。</p>
<p><strong>例 3.3. 使用 openAuth</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-3.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">SASL_USER = <span class="string">&quot;my-super-user&quot;</span></span><br><span class="line">SASL_PASS = <span class="string">&quot;my-super-user&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">request_cred</span>(<span class="params">credentials, user_data</span>):</span><br><span class="line">    <span class="keyword">for</span> credential <span class="keyword">in</span> credentials:</span><br><span class="line">        <span class="keyword">if</span> credential[<span class="number">0</span>] == libvirt.VIR_CRED_AUTHNAME:</span><br><span class="line">            credential[<span class="number">4</span>] = SASL_USER</span><br><span class="line">        <span class="keyword">elif</span> credential[<span class="number">0</span>] == libvirt.VIR_CRED_PASSPHRASE:</span><br><span class="line">            credential[<span class="number">4</span>] = SASL_PASS</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">auth = [[libvirt.VIR_CRED_AUTHNAME, libvirt.VIR_CRED_PASSPHRASE], request_cred, <span class="literal">None</span>]</span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.openAuth(<span class="string">&#x27;qemu+tcp://localhost/system&#x27;</span>, auth, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>要测试上述程序，必须具备以下配置：</p>
<ol>
<li><strong>&#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf</strong></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">listen_tls = 0</span><br><span class="line">listen_tcp = 1</span><br><span class="line">auth_tcp = &quot;sasl&quot;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>&#x2F;etc&#x2F;sasl2&#x2F;libvirt.conf</strong></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mech_list: digest-md5</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>SASL 数据库中已添加 virt 用户：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ saslpasswd2 -a libvirt virt</span><br><span class="line">Password:</span><br><span class="line">Again (<span class="keyword">for</span> verification):</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>libvirtd 已使用 <em>–listen</em> 启动</li>
</ol>
<p>配置完成后，<em>例 3.3 “使用 openAuth “</em> 就可以使用配置的用户名和密码，并允许对 libvirtd 进行读写访问。</p>
<p>与 libvirt C 接口不同，Python 不提供用于收集凭证的自定义回调。</p>
<h3 id="3-1-4-Close"><a href="#3-1-4-Close" class="headerlink" title="3.1.4 Close"></a>3.1.4 Close</h3><p>不再需要连接时，必须调用 <strong>virConnection</strong> 类的 <strong>close</strong> 方法来释放连接。连接是有引用计数的对象，因此每次 <strong>open</strong> 函数调用都应相应地调用 <strong>close</strong> 方法。</p>
<p>连接是有引用计数的；初始化（<strong>open</strong>、<strong>openAuth</strong> 等）会明确增加引用计数；其他依赖于连接存活的方法也会临时增加引用计数。<strong>open</strong> 函数调用应具有匹配的 <strong>close</strong>，所有其他引用将在相应操作完成后释放。</p>
<p>在 Python 中，当类实例离开作用域或程序结束时，引用计数会自动减少。</p>
<p><strong>例 3.4. 使用带有附加引用的 close</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-5.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn1 = libvirt.<span class="built_in">open</span>(<span class="string">&#x27;qemu:///system&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> conn1 == <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Failed to open connection to qemu:///system&#x27;</span>, file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">conn2 = libvirt.<span class="built_in">open</span>(<span class="string">&#x27;qemu:///system&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> conn2 == <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Failed to open connection to qemu:///system&#x27;</span>, file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">conn1.close()</span><br><span class="line">conn2.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>还要注意的是，与连接（virDomain、virNetwork 等）相关的每个其他类实例也将持有连接的引用。</p>
<h2 id="3-2-URI-格式"><a href="#3-2-URI-格式" class="headerlink" title="3.2 URI 格式"></a>3.2 URI 格式</h2><p>Libvirt 使用统一资源标识符 (URI) 来标识管理程序连接。libvirt 使用 URI 对本地和远程管理程序进行寻址。URI 方案和路径定义了要连接的管理程序，而 URI 的主机部分则决定了管理程序的位置。</p>
<h3 id="3-2-1-本地-URI"><a href="#3-2-1-本地-URI" class="headerlink" title="3.2.1 本地 URI"></a>3.2.1 本地 URI</h3><p>Libvirt 本地 URI 有以下几种形式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">driver:///system</span><br><span class="line">driver:///session</span><br><span class="line">driver+unix:///system</span><br><span class="line">driver+unix:///session</span><br></pre></td></tr></table></figure>

<p>libvirt URI 的所有其他用途都被视为远程，即使连接到 localhost 也是如此。有关远程 URI 的详细信息，请参见 *第 3.2.2 节 “远程 URI”*。</p>
<p>目前支持以下驱动程序：</p>
<table>
<thead>
<tr>
<th><strong>驱动</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>qemu</td>
<td>用于管理 qemu 和 KVM 客户端</td>
</tr>
<tr>
<td>xen</td>
<td>用于管理旧式（Xen 3.1 及更旧版本）Xen 客户端</td>
</tr>
<tr>
<td>xenapi</td>
<td>用于管理新式 Xen 客户端</td>
</tr>
<tr>
<td>uml</td>
<td>用于管理 UML 来宾</td>
</tr>
<tr>
<td>lxc</td>
<td>用于管理 Linux 容器</td>
</tr>
<tr>
<td>vbox</td>
<td>用于管理 VirtualBox 客户端</td>
</tr>
<tr>
<td>openvz</td>
<td>用于管理 OpenVZ 容器</td>
</tr>
<tr>
<td>esx</td>
<td>用于管理 VMware ESX 客户端</td>
</tr>
<tr>
<td>gsx</td>
<td>用于管理 VMware GSX 客户端</td>
</tr>
<tr>
<td>vpx</td>
<td>用于管理 VMware VPX 客户端</td>
</tr>
<tr>
<td>hyperv</td>
<td>用于管理 Microsoft Hyper-V 客户端</td>
</tr>
</tbody></table>
<p>下面的示例展示了如何使用本地 URI 连接到本地 QEMU 虚拟机管理程序。</p>
<p><strong>例 3.5. 连接本地 QEMU 虚拟机管理程序</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-6.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>请注意，并非所有列出的驱动程序都可以这样使用。两个明显的例外是 LXC 驱动程序和仅客户端驱动程序。与 LXC 驱动程序建立连接的方法见下例。</p>
<p><strong>例 3.6. 连接本地 LXC 虚拟机管理程序</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-32.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&#x27;lxc://&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>客户端专用驱动程序包括 ESX、VPX、GPX 和 Hyper-V。与其他驱动程序相比，这些驱动程序不能与远程传输机制一起使用。这意味着以下 URI 无效：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">esx+ssh://example.com</span><br></pre></td></tr></table></figure>

<p>下面举例说明如何正确使用这些驱动程序。</p>
<p><strong>例 3.7. 连接到客户端驱动程序</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-33.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line"><span class="comment"># use VPX over HTTPS, select ESX server &#x27;srv1&#x27; in datacenter &#x27;dc1&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&#x27;vpx://example-vcenter.com/dc1/srv1&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="3-2-2-远程-URI"><a href="#3-2-2-远程-URI" class="headerlink" title="3.2.2 远程 URI"></a>3.2.2 远程 URI</h3><p>远程 URI 采用一般形式（”[…]“ 表示可选部分）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver[+transport]://[username@][hostname][:port]/[path][?extraparameters]</span><br></pre></td></tr></table></figure>

<p>下表介绍了 URI 的各个组成部分。</p>
<table>
<thead>
<tr>
<th><strong>组件</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>driver</td>
<td>要连接到的 libvirt hypervisor 驱动程序的名称。这与本地 URI 中使用的名称相同。一些示例包括 xen、qemu、lxc、openvz 和 test。作为特殊情况，可以使用伪驱动程序名称 remote，这将导致远程守护进程探测活动的 hypervisor，并选择一个来使用。作为一般规则，如果应用程序知道它需要哪种 hypervisor，应始终明确指定驱动程序名称，而不依赖于自动探测。</td>
</tr>
<tr>
<td>transport</td>
<td>数据传输之一的名称。可能的值包括 <strong>tls</strong>、<strong>tcp</strong>、<strong>unix</strong>、<strong>ssh</strong> 和 <strong>ext</strong>。如果省略，则在提供主机名的情况下默认为 <strong>tls</strong>，在未提供主机名的情况下默认为 <strong>unix</strong>。</td>
</tr>
<tr>
<td>username</td>
<td>使用 SSH 数据传输时，可以选择与客户端当前登录名不同的用户名。</td>
</tr>
<tr>
<td>hostname</td>
<td>远程计算机的全限定主机名。如果使用带有 x509 证书的 TLS 或带有 GSSAPI&#x2F;Keberos 插件的 SASL，该主机名必须与服务器 x509 证书&#x2F;Kerberos 原理中使用的主机名一致。不匹配的主机名将导致验证失败。</td>
</tr>
<tr>
<td>port</td>
<td>很少需要，除非 SSH 或 libvirtd 已配置为在非标准 TCP 端口上运行。SSH 数据传输默认端口为 <strong>22</strong>，<strong>16509</strong> 用于 TCP 数据传输，<strong>16514</strong> 用于 TLS 数据传输。</td>
</tr>
<tr>
<td>path</td>
<td>路径应与管理程序驱动程序的本地 URI 所用路径相同。对于 Xen，路径始终是 **&#x2F;**，而对于 QEMU，路径则是 <strong>&#x2F;system</strong>。</td>
</tr>
<tr>
<td>extraparameters</td>
<td>URI 查询参数可以对远程连接的某些方面进行微调，下一节将对此进行深入讨论。</td>
</tr>
</tbody></table>
<p>根据此处描述的信息，并参考本文件前面提到的管理程序专用 URI，现在可以举例说明一些远程访问 URI。</p>
<p>使用 ssh 隧道数据传输和 ssh 用户名 <em>root</em> 连接到主机 <em>node.example.com</em> 上的远程 Xen 虚拟机管理程序：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xen+ssh://root@node.example.com/</span><br></pre></td></tr></table></figure>

<p>使用 TLS 和 x509 证书连接到主机 <em>node.example.com</em> 上的远程 QEMU 虚拟机：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qemu://node.example.com/system</span><br></pre></td></tr></table></figure>

<p>使用 TLS 连接到主机 <em>node.example.com</em> 上的远程 Xen 虚拟机，跳过对服务器 x509 证书的验证（注意：这会危及你的安全）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xen://node.example.com/?no_verify=1</span><br></pre></td></tr></table></figure>

<p>通过非标准 Unix 套接字连接本地 QEMU 实例（在这种情况下要明确提供 Unix 套接字的完整路径）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qemu+unix:///system?socket=/opt/libvirt/run/libvirt/libvirt-sock</span><br></pre></td></tr></table></figure>

<p>连接到 libvirtd 守护进程，在另一个 TCP 端口 5000 上提供未加密的 TCP&#x2F;IP 连接，并使用默认配置的测试驱动程序：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test+tcp://node.example.com:5000/default</span><br></pre></td></tr></table></figure>

<h3 id="Extra-parameters"><a href="#Extra-parameters" class="headerlink" title="Extra parameters"></a>Extra parameters</h3><p>远程 URI 可以在查询字符串（”?” 后面的部分）中添加额外参数。远程 URI 可以理解以下所示的额外参数。任何其他参数都将不加修改地传递到后端。请注意，参数值必须使用 URI 转义。更多信息请参阅 <em><a target="_blank" rel="noopener" href="http://xmlsoft.org/">http://xmlsoft.org/</a> html&#x2F;libxml-uri.html#xmlURlEscapeStr。</em></p>
<table>
<thead>
<tr>
<th><strong>名称</strong></th>
<th><strong>运输</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>name</td>
<td><em>任何运输</em></td>
<td>传递给远程 virConnectOpen 函数的本地管理程序 URI。该 URI 通常是通过删除远程 URI 中的传输、主机名、端口号、用户名和额外参数形成的，但在某些非常复杂的情况下，可能需要明确提供名称。例如：<strong>name&#x3D;qemu:&#x2F;&#x2F;&#x2F;system</strong></td>
</tr>
<tr>
<td>command</td>
<td>ssh、ext</td>
<td>外部命令。对于 ext 传输，这是必需的。对于 ssh，默认为 ssh。搜索 PATH 以查找命令。例如：<strong>command&#x3D;&#x2F;opt&#x2F;openssh&#x2F;bin&#x2F;ssh</strong></td>
</tr>
<tr>
<td>socket</td>
<td>unix, ssh</td>
<td>外部命令。对于 ext 传输，这是必需的。对于 ssh，默认为 <strong>ssh</strong>。会在 PATH 中搜索命令。示例：<strong>socket&#x3D;&#x2F;opt&#x2F;libvirt&#x2F;run&#x2F;libvirt&#x2F;libvirt-sock</strong></td>
</tr>
<tr>
<td>netcat</td>
<td>ssh</td>
<td>远程计算机上 netcat 命令的名称。默认为 nc。对于 ssh 传输，libvirt 构建的 ssh 命令类似于 <code>command -p port [-l username] hostname netcat -U socket</code>，其中端口、用户名、主机名可作为远程 URI 的一部分指定，而命令、netcat 和 socket 则来自额外参数（或合理的默认值）。例如：<strong>netcat&#x3D;&#x2F;opt&#x2F;netcat&#x2F;bin&#x2F;nc</strong></td>
</tr>
<tr>
<td>no_verify</td>
<td>tls</td>
<td>如果设置的值不为零，则会禁用客户端对服务器证书的检查。请注意，要禁用服务器对客户端的检查，您必须更改 libvirtd 配置。示例：<strong>no_verify&#x3D;1</strong></td>
</tr>
<tr>
<td>no_tty</td>
<td>ssh</td>
<td>如果设置为非零，当 ssh 无法自动登录远程机器时（例如，使用 ssh-agent 时），该值将阻止 ssh 询问密码。在无法访问终端时使用此功能，例如在使用 libvirt 的图形程序中。例如 <strong>no_tty&#x3D;1</strong></td>
</tr>
</tbody></table>
<h2 id="3-3-Capability-Information-Methods"><a href="#3-3-Capability-Information-Methods" class="headerlink" title="3.3 Capability Information Methods"></a>3.3 Capability Information Methods</h2><p>下面的示例展示了如何使用远程 URI 连接 QEMU 虚拟机管理程序。</p>
<p><strong>例 3.8. 连接远程 QEMU 虚拟机管理程序</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-7.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&#x27;qemu+tls://host2/system&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p><strong>getCapabilities</strong> 方法调用可用于获取有关虚拟化主机功能的信息。如果调用成功，它将返回一个包含 capabilities XML 的 Python 字符串（如下所述）。如果发生错误，则返回 <strong>None</strong>。以下代码演示了 <strong>getCapabilities</strong> 方法的使用：</p>
<p><strong>例 3.9. 使用 getCapabilities</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-8.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">caps = conn.getCapabilities()  <span class="comment"># caps 将是一个 XML 字符串</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Capabilities:\n&#x27;</span> + caps)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>capabilities XML 格式提供了主机虚拟化技术的相关信息。特别是，它描述了虚拟化主机的功能、虚拟化驱动程序以及虚拟化技术可启动的客户类型。请注意，根据使用的 libvirt 驱动程序，能力 XML 可能（也确实）有所不同。能力 XML 示例如下：</p>
<p><strong>例 3.10. QEMU 驱动程序功能示例</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">capabilities</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">host</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cpu</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">arch</span>&gt;</span>x86_64<span class="tag">&lt;/<span class="name">arch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">cpu</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">migration_features</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">live</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">uri_transports</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">uri_transport</span>&gt;</span>tcp<span class="tag">&lt;/<span class="name">uri_transport</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">uri_transports</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">migration_features</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">topology</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">cells</span> <span class="attr">num</span>=<span class="string">&#x27;1&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">cell</span> <span class="attr">id</span>=<span class="string">&#x27;0&#x27;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">cpus</span> <span class="attr">num</span>=<span class="string">&#x27;2&#x27;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">cpu</span> <span class="attr">id</span>=<span class="string">&#x27;0&#x27;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">cpu</span> <span class="attr">id</span>=<span class="string">&#x27;1&#x27;</span>/&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">cpus</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">cell</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">cells</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">topology</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">guest</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">os_type</span>&gt;</span>hvm<span class="tag">&lt;/<span class="name">os_type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arch</span> <span class="attr">name</span>=<span class="string">&#x27;i686&#x27;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">wordsize</span>&gt;</span>32<span class="tag">&lt;/<span class="name">wordsize</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">emulator</span>&gt;</span>/usr/bin/qemu<span class="tag">&lt;/<span class="name">emulator</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">machine</span>&gt;</span>pc<span class="tag">&lt;/<span class="name">machine</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">machine</span>&gt;</span>isapc<span class="tag">&lt;/<span class="name">machine</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">domain</span> <span class="attr">type</span>=<span class="string">&#x27;qemu&#x27;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">domain</span> <span class="attr">type</span>=<span class="string">&#x27;kvm&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">emulator</span>&gt;</span>/usr/bin/qemu-kvm<span class="tag">&lt;/<span class="name">emulator</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">domain</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">arch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">features</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">pae</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">nonpae</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">acpi</span> <span class="attr">default</span>=<span class="string">&#x27;on&#x27;</span> <span class="attr">toggle</span>=<span class="string">&#x27;yes&#x27;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">apic</span> <span class="attr">default</span>=<span class="string">&#x27;on&#x27;</span> <span class="attr">toggle</span>=<span class="string">&#x27;no&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">features</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">guest</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">guest</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">os_type</span>&gt;</span>hvm<span class="tag">&lt;/<span class="name">os_type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arch</span> <span class="attr">name</span>=<span class="string">&#x27;x86_64&#x27;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">wordsize</span>&gt;</span>64<span class="tag">&lt;/<span class="name">wordsize</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">emulator</span>&gt;</span>/usr/bin/qemu-system-x86_64<span class="tag">&lt;/<span class="name">emulator</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">machine</span>&gt;</span>pc<span class="tag">&lt;/<span class="name">machine</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">machine</span>&gt;</span>isapc<span class="tag">&lt;/<span class="name">machine</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">domain</span> <span class="attr">type</span>=<span class="string">&#x27;qemu&#x27;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">domain</span> <span class="attr">type</span>=<span class="string">&#x27;kvm&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">emulator</span>&gt;</span>/usr/bin/qemu-kvm<span class="tag">&lt;/<span class="name">emulator</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">domain</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">arch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">features</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">acpi</span> <span class="attr">default</span>=<span class="string">&#x27;on&#x27;</span> <span class="attr">toggle</span>=<span class="string">&#x27;yes&#x27;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">apic</span> <span class="attr">default</span>=<span class="string">&#x27;on&#x27;</span> <span class="attr">toggle</span>=<span class="string">&#x27;no&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">features</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">guest</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">capabilities</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 capabilities XML 中，总有一个 <strong>&#x2F;host</strong> 子文档，以及零个或多个 <strong>&#x2F;guest</strong> 子文档（虽然允许零个 guest 子文档，但这意味着该特定驱动程序的任何 guest 都不能在该特定主机上启动）。</p>
<p><strong>&#x2F;host</strong> 子文档描述主机的功能。</p>
<p><strong>&#x2F;host&#x2F;uuid</strong> 显示主机的 UUID。如果 SMBIOS UUID 可用且有效，则从 SMBIOS UUID 派生，或者在 libvirtd.conf 中用自定义值覆盖。如果以上两项都未正确设置，则每次重启 libvirtd 时都会生成一个临时 UUID。</p>
<p><strong>&#x2F;host&#x2F;cpu</strong> 子文档描述了主机 CPU 的能力。libvirt 在决定是否能在这台特定机器上正确启动客户机时会用到它，在实时迁移过程中也会参考它，以确定目标机器是否提供继续运行客户机所需的标志。</p>
<p><strong>&#x2F;host&#x2F;cpu&#x2F;arch</strong> 是描述底层主机 CPU 架构的必要 XML 节点。截至本文撰写时，所有 libvirt 驱动程序都会根据 uname(2) 的输出将其初始化。</p>
<p><strong>&#x2F;host&#x2F;cpu&#x2F;features</strong> 是一个可选的子文档，用于描述主机上存在的其他 CPU 功能。目前，xen 驱动程序仅使用它来报告是否存在 svm 或 vmx 标志，以及是否存在 pae 标志。</p>
<p><strong>&#x2F;host&#x2F;cpu&#x2F;model</strong> 是一个可选元素，用于描述与主机 CPU 最相似的 CPU 型号。libvirt 当前了解的 CPU 型号列表位于 cpu_map.xml 文件中。</p>
<p><strong>&#x2F;host&#x2F;cpu&#x2F;feature</strong> 是零个或多个元素，用于描述主机 CPU 所具有的其他 CPU 特性，这些特性不在 <strong>&#x2F;host&#x2F;cpu&#x2F;model</strong> 中涵盖。</p>
<p><strong>&#x2F;host&#x2F;migration_features</strong> 是一个可选的子文档，用于描述该驱动程序在该主机上支持的迁移功能（如果有）。如果该子文档不存在，则不支持迁移。目前，xen、qemu 和 esx 驱动程序支持迁移。</p>
<p>如果驱动程序支持实时迁移，则存在 <strong>&#x2F;host&#x2F;migration_features&#x2F;live</strong> XML 节点。</p>
<p><strong>&#x2F;host&#x2F;migration_features&#x2F;uri_transports</strong> 是一个可选的子文档，描述了备用的迁移连接机制。这些备用连接机制在多主机虚拟化系统中非常有用。例如，virsh migrate 命令可以通过 10.0.0.1 连接到迁移源，通过 10.0.0.2 连接到迁移目标。但是，由于安全策略的原因，迁移源可能只能通过 192.168.0.0&#x2F;24 直接与迁移目标通信。在这种情况下，使用备用迁移连接机制将使迁移成功。截至本文撰写之时，xen 驱动程序支持备用迁移机制 “xenmigr”，而 qemu 驱动程序则支持备用迁移机制 “tcp”。更多信息，请参阅迁移文档。</p>
<p><strong>&#x2F;host&#x2F;topology</strong> 子文档描述主机的 NUMA 拓扑；每个 NUMA 节点由一个 <strong>&#x2F;host&#x2F;topology&#x2F;cells&#x2F;cell</strong> 表示，并描述该 NUMA 节点中的 CPU。如果主机是 UMA（非 NUMA）机器，则只有一个单元，所有 CPU 都在该单元中。这与硬件的具体情况密切相关，因此在不同的机器上必然会有所不同。</p>
<p><strong>&#x2F;host&#x2F;secmodel</strong> 是一个可选的子文档，用于描述主机上使用的安全模型。</p>
<p><strong>&#x2F;host&#x2F;secmodel&#x2F;model</strong> 显示安全模型的名称，而 <strong>&#x2F;host&#x2F;secmodel&#x2F;doi</strong> 则显示解释域。有关安全的更多信息，请参阅安全部分。</p>
<p>每个 <strong>&#x2F;guest</strong> 子文档都描述了该主机驱动程序可以启动的一种客户机。该描述包括客户机的架构（即 i686）以及提供给客户机的 ABI（即 hvm、xen 或 uml）。</p>
<p><strong>&#x2F;guest&#x2F;os_type</strong> 是描述来宾类型的必填元素。</p>
<table>
<thead>
<tr>
<th><strong>驱动</strong></th>
<th><strong>客人类型</strong></th>
</tr>
</thead>
<tbody><tr>
<td>qemu</td>
<td>总是 “hvm”</td>
</tr>
<tr>
<td>xen</td>
<td>准虚拟化客户机可以使用 “xen”，完全虚拟化客户机可以使用 “hvm”。</td>
</tr>
<tr>
<td>uml</td>
<td>总是 “uml”</td>
</tr>
<tr>
<td>lxc</td>
<td>始终为 “exe”</td>
</tr>
<tr>
<td>vbox</td>
<td>总是 “hvm”</td>
</tr>
<tr>
<td>openvz</td>
<td>始终为 “exe”</td>
</tr>
<tr>
<td>one</td>
<td>总是 “hvm”</td>
</tr>
<tr>
<td>ex</td>
<td>暂不支持</td>
</tr>
</tbody></table>
<p><strong>&#x2F;guest&#x2F;arch</strong> 是描述该客户机类型各种虚拟硬件的 XML 子文档的根。它有一个名为 “name” 的属性，可用于回溯该子文档。</p>
<p><strong>&#x2F;guest&#x2F;arch&#x2F;wordsize</strong> 是一个必填元素，用于描述该客户机类型每个字使用的位数。通常为 32 或 64。</p>
<p><strong>&#x2F;guest&#x2F;arch&#x2F;emulator</strong> 是一个可选元素，用于描述该客户机类型模拟器的默认路径。请注意，对于需要备用二进制文件的客户机类型，仿真器可以被 <strong>&#x2F;guest&#x2F;arch&#x2F;domain&#x2F;emulator</strong> 元素（如下所述）覆盖。</p>
<p><strong>&#x2F;guest&#x2F;arch&#x2F;loader</strong> 是一个可选元素，用于描述该客户机类型固件加载器的默认路径。请注意，对于使用备用加载器的客户机类型，默认加载器路径可被 <strong>&#x2F;guest&#x2F;arch&#x2F;domain&#x2F;loader</strong> 元素（如下所述）覆盖。目前，只有用于 HVM 客户机的 xen 驱动程序使用了这一功能。</p>
<p>可以有零个或多个 <strong>&#x2F;guest&#x2F;arch&#x2F;machine</strong> 元素来描述该客户机模拟器可以模拟的默认机器类型。这些 “机器” 通常代表 guest 可以启动的 ABI 或硬件接口。请注意，对于提供其他机器类型的虚拟化技术，这些机器类型可以被 <strong>&#x2F;guest&#x2F;arch&#x2F;domain&#x2F;machine</strong> 元素（如下所述）覆盖。其典型值为 “pc” 和 “isapc”，分别表示基于 PCI 的普通 PC 和基于 ISA 的旧 PC。</p>
<p>可以有零个或多个 <strong>&#x2F;guest&#x2F;arch&#x2F;domain</strong> XML 子树（但如果 &#x2F;guest&#x2F;arch&#x2F;domain XML 子树为零，则无法启动该驱动程序的任何客户）。每个 <strong>&#x2F;guest&#x2F;arch&#x2F;domain</strong> XML 子树都有可选的 <code>&lt;emulator&gt;</code>、<code>&lt;loader&gt;</code> 和 <code>&lt;machine&gt;</code> 元素，这些元素会覆盖上文指定的默认值。对于缺失的元素，将使用默认值。</p>
<p><strong>&#x2F;guest&#x2F;features</strong> 可选子文档描述了可启用或禁用的各种附加访客功能，以及它们的默认状态和是否可以打开或关闭。</p>
<h2 id="3-4-主机信息"><a href="#3-4-主机信息" class="headerlink" title="3.4 主机信息"></a>3.4 主机信息</h2><p>有多种 Python <strong>virConnection</strong> 方法可用于获取虚拟化主机的信息，包括主机名、最大支持客户 CPU 等。</p>
<h3 id="获取主机名"><a href="#获取主机名" class="headerlink" title="获取主机名"></a>获取主机名</h3><p><strong>getHostname</strong> 方法可用于获取 <strong>gethostname()</strong> 返回的虚拟化主机的主机名。该方法通过 virConnectioninstance 调用，如果成功，将返回一个包含主机名的字符串，该主机名可能扩展为全称域名。如果发生错误，则返回 NULL。以下代码演示了如何使用 <strong>getHostname</strong>：</p>
<p><strong>例 3.11. 使用 getHostname</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-9.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">host = conn.getHostname()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Hostname:&#x27;</span> + host)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="getMaxVcpus"><a href="#getMaxVcpus" class="headerlink" title="getMaxVcpus"></a>getMaxVcpus</h3><p><strong>getMaxVcpus</strong> 方法可用于获取底层虚拟化技术所支持的每个虚拟机的最大虚拟 CPU 数量。该方法将虚拟化 “类型” 作为输入（可以是 <strong>None</strong>），如果成功，则返回所支持的虚拟 CPU 数量。如果出错，则返回 -1。以下代码演示了 <strong>getMaxVcpus</strong> 的使用：</p>
<p><strong>例 3.12. 使用 getMaxVcpus</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-10.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">vcpus = conn.getMaxVcpus(<span class="literal">None</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Maximum support virtual CPUs:&#x27;</span> + <span class="built_in">str</span>(vcpus))</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="getInfo"><a href="#getInfo" class="headerlink" title="getInfo"></a>getInfo</h3><p><strong>getInfo</strong> 方法可用于获取虚拟化主机的各种信息。该方法如果成功则返回一个 Python <strong>列表</strong>，如果出错则返回 <strong>None</strong>。Python <strong>列表</strong> 包含以下成员：</p>
<table>
<thead>
<tr>
<th><strong>成员</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>list[0]</td>
<td>表示 CPU 型号的字符串</td>
</tr>
<tr>
<td>list[1]</td>
<td>内存大小（兆字节）</td>
</tr>
<tr>
<td>list[2]</td>
<td>运行中的 CPU 数量</td>
</tr>
<tr>
<td>list[3]</td>
<td>预期 CPU 频率（兆赫）</td>
</tr>
<tr>
<td>list[4]</td>
<td>NUMA 节点的数量，1 表示统一内存访问</td>
</tr>
<tr>
<td>list[5]</td>
<td>每个节点的 CPU 插座数量</td>
</tr>
<tr>
<td>list[6]</td>
<td>每个插座的内核数</td>
</tr>
<tr>
<td>list[7]</td>
<td>每个核心的线程数</td>
</tr>
</tbody></table>
<p>以下代码演示了 <strong>virNodeGetInfo</strong> 的使用：</p>
<p><strong>例 3.13. 使用 getInfo</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-12.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">nodeinfo = conn.getInfo()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Model:&#x27;</span> + <span class="built_in">str</span>(nodeinfo[<span class="number">0</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Memory size: &#x27;</span> + <span class="built_in">str</span>(nodeinfo[<span class="number">1</span>]) + <span class="string">&#x27;MB&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Number of CPUs:&#x27;</span> + <span class="built_in">str</span>(nodeinfo[<span class="number">2</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;CPU 的主频:&#x27;</span> + <span class="built_in">str</span>(nodeinfo[<span class="number">3</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;NUMA 节点数:&#x27;</span> + <span class="built_in">str</span>(nodeinfo[<span class="number">4</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;CPU 插座数:&#x27;</span> + <span class="built_in">str</span>(nodeinfo[<span class="number">5</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Number of CPU cores per socket:&#x27;</span> + <span class="built_in">str</span>(nodeinfo[<span class="number">6</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;每个内核的 CPU 线程数:&#x27;</span> + <span class="built_in">str</span>(nodeinfo[<span class="number">7</span>]))</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="getCellsFreeMemory"><a href="#getCellsFreeMemory" class="headerlink" title="getCellsFreeMemory"></a>getCellsFreeMemory</h3><p><strong>getCellsFreeMemory</strong> 方法可用于获取系统中部分或全部 NUMA 节点的可用内存量（以千字节为单位）。该方法需要输入起始单元和要检索数据的最大单元数。如果成功，<strong>将</strong>返回 Python <strong>列表</strong>，其中包含每个节点的可用内存量。如果失败，<strong>则</strong>返回 “<strong>none</strong>“。以下代码演示了 <strong>getCellsFreeMemory</strong> 的使用：</p>
<p><strong>例 3.14. 使用 getCellsFreeMemory</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-13.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">nodeinfo = conn.getInfo()</span><br><span class="line">numnodes = nodeinfo[<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">memlist = conn.getCellsFreeMemory(<span class="number">0</span>, numnodes)</span><br><span class="line">cell = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> cellfreemem <span class="keyword">in</span> memlist:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Node &#x27;</span> + <span class="built_in">str</span>(cell) + <span class="string">&#x27;: &#x27;</span> + <span class="built_in">str</span>(cellfreemem) + <span class="string">&#x27; bytes free memory&#x27;</span>)</span><br><span class="line">    cell += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="getType"><a href="#getType" class="headerlink" title="getType"></a>getType</h3><p><strong>getType</strong> 方法可用于获取此连接上使用的虚拟化类型。如果成功，它将返回一个字符串，表示正在使用的虚拟化类型。如果发生错误，则返回 <strong>None</strong>。以下代码演示了 <strong>getType</strong> 的使用：</p>
<p><strong>例 3.15. 使用 virConnectGetType</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-14.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Virtualization type: &#x27;</span> + conn.getType())</span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="获取库和驱动程序版本"><a href="#获取库和驱动程序版本" class="headerlink" title="获取库和驱动程序版本"></a>获取库和驱动程序版本</h3><p>libvirt 库具有软件包和库本身的版本信息。如下所示，可以打印这些信息。</p>
<p><strong>例 3.16. 使用 virConnectGetVersion</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-34.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Package Version: &quot;</span> + libvirt.sys.version)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Library Version:&quot;</span> + <span class="built_in">str</span>(libvirt.sys.version_info))</span><br><span class="line"></span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>程序库支持的每个驱动程序都有自己的版本。版本号为整数：1000000<em>主版本 + 1000</em> 次版本 + 发行版本。下面的示例演示了如何打印驱动程序的版本号。</p>
<p><strong>例 3.17. 使用 virConnectGetVersion</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-15.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">ver = conn.getVersion()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Version: &#x27;</span> + <span class="built_in">str</span>(ver))</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="getURI"><a href="#getURI" class="headerlink" title="getURI"></a>getURI</h3><p><strong>getURI</strong> 方法可用于获取当前连接的 URI。虽然这通常与传入 <strong>打开</strong> 调用的字符串相同，但底层驱动程序有时会将字符串规范化。此方法将返回规范版本。如果成功，它将返回一个 URI 字符串。如果发生错误，则返回 <strong>None</strong>。以下代码演示了如何使用 <strong>getURI</strong>：</p>
<p><strong>例 3.18. 使用 virConnectGetURI</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-17.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">uri = conn.getURI()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Canonical URI: &#x27;</span> + uri)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="isEncrypted"><a href="#isEncrypted" class="headerlink" title="isEncrypted"></a>isEncrypted</h3><p><strong>isEncrypted</strong> 方法可用于查找给定连接是否已加密。如果成功，加密连接将返回 1，未加密连接将返回 0。如果发生错误，则返回 -1。下面的代码演示了 <strong>isEncrypted</strong> 的使用：</p>
<p><strong>例 3.19. 使用 virConnectIsEncrypted</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-15.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Connection is encrypted:&#x27;</span> + <span class="built_in">str</span>(conn.isEncrypted()))</span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="isSecure"><a href="#isSecure" class="headerlink" title="isSecure"></a>isSecure</h3><p><strong>isSecure</strong> 方法可用于查找给定连接是否安全。如果一个连接是加密的，或者是在一个不会受到以下攻击的信道上运行，那么它就会被归类为安全连接：</p>
<p>窃听（如 UNIX 域套接字）。如果连接成功，则返回 1 表示连接安全，返回 0 表示连接不安全。如果发生错误，则返回 -1。以下代码演示了 <strong>isSecure</strong> 的使用：</p>
<p><strong>例 3.20. 使用 virConnectIsSecure</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-19.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Connection is secure:&#x27;</span> + <span class="built_in">str</span>(conn.isSecure()))</span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="isAlive"><a href="#isAlive" class="headerlink" title="isAlive"></a>isAlive</h3><p>该方法可确定与管理程序的连接是否仍然有效。如果连接是本地连接，或通过未关闭的通道（TCP 或 UNIX 套接字）运行，则该连接将被归类为 “存活” 连接。</p>
<p><strong>例 3.21. 使用 isAlive</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-21.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">alive = conn.isAlive()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Connection is alive = &quot;</span> + <span class="built_in">str</span>(alive))</span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="compareCPU"><a href="#compareCPU" class="headerlink" title="compareCPU"></a>compareCPU</h3><p>该方法将给定的 CPU 描述与主机 CPU 进行比较。该 XML 描述参数与用于域描述的 XML 描述参数相同。</p>
<p><strong>例 3.22. 使用 compareCPU</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-22.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">xml = <span class="string">&#x27;&lt;cpu mode=&quot;custom&quot; match=&quot;exact&quot;&gt;&#x27;</span> +\</span><br><span class="line">      <span class="string">&#x27;&lt;model fallback=&quot;forbid&quot;&gt;kvm64&lt;/model&gt;&#x27;</span> +\</span><br><span class="line">      <span class="string">&#x27;&lt;/cpu&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">retc = conn.compareCPU(xml)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> retc == libvirt.VIR_CPU_COMPARE_ERROR:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;CPU 不一致或出错&quot;</span>)</span><br><span class="line"><span class="keyword">elif</span> retc == libvirt.VIR_CPU_COMPARE_INCOMPATIBLE:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;CPU 不兼容&quot;</span>)</span><br><span class="line"><span class="keyword">elif</span> retc == libvirt.VIR_CPU_COMPARE_IDENTICAL:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;CPU 完全相同&quot;</span>)</span><br><span class="line"><span class="keyword">elif</span> retc == libvirt.VIR_CPU_COMPARE_SUPERSET:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;The host CPU is better than the one specified.&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;An Unknown return code was emitted.&quot;</span>)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="getFreeMemory"><a href="#getFreeMemory" class="headerlink" title="getFreeMemory"></a>getFreeMemory</h3><p>getFreeMemory 方法可用于查找主机节点上的可用内存量。注意：大多数 libvirt API 以千字节为单位提供内存大小，但在此函数中，返回值以字节为单位。必要时除以 1024。</p>
<p><strong>例 3.23. 使用 getFreeMemory</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-23.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">mem = conn.getFreeMemory()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Free memory on the node (host) is &quot;</span> + <span class="built_in">str</span>(mem) + <span class="string">&quot; bytes.&quot;</span>)</span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="getFreePages"><a href="#getFreePages" class="headerlink" title="getFreePages"></a>getFreePages</h3><p>该方法用于查询主机系统中指定大小的空闲页面。对于输入，<strong>pages</strong> 参数是调用者感兴趣的页面大小的 Python 列表（大小单位是千字节，例如传递 2048 表示 2MB），<strong>start</strong> 参数指的是应该收集信息的第一个 NUMA 节点，<strong>cellcount</strong> 参数告诉应该查询多少个连续节点。函数会返回一个 Python 列表，其中包含是否有指定输入大小的页面的指示符。</p>
<p>如果主机系统不支持所请求大小的内存页，则会出现错误。</p>
<p><strong>例 3.24. 使用 getFreePages</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-24.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">pages = [<span class="number">2048</span>]</span><br><span class="line">start = <span class="number">0</span></span><br><span class="line">cellcount = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">buf = conn.getFreePages(pages, start, cellcount)</span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> page <span class="keyword">in</span> buf:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Page Size: &quot;</span> + <span class="built_in">str</span>(pages[i]) + <span class="string">&quot; Available pages:&quot;</span> + <span class="built_in">str</span>(page))</span><br><span class="line">    ++i</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="获取内存参数"><a href="#获取内存参数" class="headerlink" title="获取内存参数"></a>获取内存参数</h3><p>该方法以字符串形式返回所有可用的内存参数。</p>
<p><strong>例 3.25. 使用 getFreePages</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-25.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">buf = conn.getMemoryParameters()</span><br><span class="line"><span class="keyword">for</span> parm <span class="keyword">in</span> buf:</span><br><span class="line">    <span class="built_in">print</span>(parm)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="getMemoryStats"><a href="#getMemoryStats" class="headerlink" title="getMemoryStats"></a>getMemoryStats</h3><p>此方法返回单个或所有单个节点（主机）的内存统计信息。它返回一个 Python 字符串列表。</p>
<p><strong>例 3.26. 使用 getMemoryStats</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-26.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">buf = conn.getMemoryStats(libvirt.VIR_NODE_MEMORY_STATS_ALL_CELLS)</span><br><span class="line"><span class="keyword">for</span> parm <span class="keyword">in</span> buf:</span><br><span class="line">    <span class="built_in">print</span>(parm)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="获取安全模型"><a href="#获取安全模型" class="headerlink" title="获取安全模型"></a>获取安全模型</h3><p>此方法返回当前使用的安全模型（列表）（如果有）。</p>
<p><strong>例 3.27. 使用 getSecurityModel</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-27.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">model = conn.getSecurityModel()</span><br><span class="line"><span class="built_in">print</span>(model[<span class="number">0</span>] + <span class="string">&quot; &quot;</span> + model[<span class="number">1</span>])</span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="获取系统信息"><a href="#获取系统信息" class="headerlink" title="获取系统信息"></a>获取系统信息</h3><p>该方法以 XML 定义的形式返回系统信息。格式与域 XML 定义相同。</p>
<p><strong>例 3.28. 使用 getSysinfo</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-28.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">xmlInfo = conn.getSysinfo()</span><br><span class="line"><span class="built_in">print</span>(xmlInfo)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="getCPUMap"><a href="#getCPUMap" class="headerlink" title="getCPUMap"></a>getCPUMap</h3><p>获取主机节点 CPU 的 CPU 映射。</p>
<p><strong>例 3.29. 使用 getCPUMap</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-29.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">map</span> = conn.getCPUMap()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;CPUs:&quot;</span> + <span class="built_in">str</span>(<span class="built_in">map</span>[<span class="number">0</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Available:&quot;</span> + <span class="built_in">str</span>(<span class="built_in">map</span>[<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="getCPUStats"><a href="#getCPUStats" class="headerlink" title="getCPUStats"></a>getCPUStats</h3><p>获取单个或所有 CPU 的统计数据。该方法需要一个代表 CPU 编号的参数，以获取单个 CPU 的统计数据；或使用 <strong>VIR_NODE_CPU_STATS_ALL_CPUS</strong> 值，以获取所有 CPU 的 Python 统计数据列表。</p>
<p><strong>例 3.30. 使用 getCPUStats</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-30.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">stats = conn.getCPUStats(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;kernel:&quot;</span> + <span class="built_in">str</span>(stats[<span class="string">&#x27;kernel&#x27;</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;idle: &quot;</span> + <span class="built_in">str</span>(stats[<span class="string">&#x27;idle&#x27;</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;user: &quot;</span> + <span class="built_in">str</span>(stats[<span class="string">&#x27;user&#x27;</span>]) + <span class="built_in">str</span>(stats[<span class="string">&#x27;user&#x27;</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;iowait: &quot;</span> + <span class="built_in">str</span>(stats[<span class="string">&#x27;iowait&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="getCPUModelNames"><a href="#getCPUModelNames" class="headerlink" title="getCPUModelNames"></a>getCPUModelNames</h3><p>获取与架构类型匹配的 CPU 名称列表。</p>
<p><strong>例 3.31. 使用 getCPUModelNames</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-31.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">models = conn.getCPUModelNames(<span class="string">&#x27;x86_64&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> model <span class="keyword">in</span> models:</span><br><span class="line">    <span class="built_in">print</span>(model)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<pre><code>
</code></pre>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="https://watsonlu6.github.io/libvirt%E6%96%87%E6%A1%A3/3-libvirt%E8%BF%9E%E6%8E%A5/" title="3 libvirt连接" target="_blank" rel="external">https://watsonlu6.github.io/libvirt文档/3-libvirt连接/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/watsonLu6/" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/watsonLu6/" target="_blank"><span class="text-dark">watson</span><small class="ml-1x">Cloud computing development engineer</small></a></h3>
        <div>内心要狂热，头脑要冷静，四肢要发达</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/libvirt%E6%96%87%E6%A1%A3/4-libvirt%E5%AE%A2%E6%88%B7%E5%9F%9FDomain/" title="4 libvirt客户域Domain"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/libvirt%E6%96%87%E6%A1%A3/2-libvirt%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/" title="2 libvirt对象模型"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
  </ul>
  
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/watsonLu6/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://weibo.com" target="_blank" title="Weibo" data-toggle=tooltip data-placement=top><i class="icon icon-weibo"></i></a></li>
        
        <li><a href="https://twitter.com" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
        <li><a href="https://www.behance.net" target="_blank" title="Behance" data-toggle=tooltip data-placement=top><i class="icon icon-behance"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   




   
    
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#vcomments',
    verify: false,
    notify: false,
    appId: '',
    appKey: '',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: meta,
    pageSize: '10' || 10,
    visitor: false
  });
  </script>

     







</body>
</html>