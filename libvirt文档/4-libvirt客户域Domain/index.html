<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>4 libvirt客户域Domain | watson Lu&#39;blogs</title>
  <meta name="description" content="4.1 Domain 概述域是运行在虚拟化机器上的操作系统实例。一个客域可以指正在运行的虚拟机或可用于启动虚拟机的配置。连接对象提供了枚举客域、创建新客域和管理现有域的方法。客域由 virDomainPtr 对象表示，并具有多个唯一标识符： 唯一标识符 ID：正整数，在一台主机上运行的客户域中是唯一的。非活动域没有 ID。如果主机操作系统是虚拟域，默认情况下 ID 为 0。例如，在 Xen 虚拟机">
<meta property="og:type" content="article">
<meta property="og:title" content="4 libvirt客户域Domain">
<meta property="og:url" content="https://watsonlu6.github.io/libvirt%E6%96%87%E6%A1%A3/4-libvirt%E5%AE%A2%E6%88%B7%E5%9F%9FDomain/index.html">
<meta property="og:site_name" content="watson&#39;blogs">
<meta property="og:description" content="4.1 Domain 概述域是运行在虚拟化机器上的操作系统实例。一个客域可以指正在运行的虚拟机或可用于启动虚拟机的配置。连接对象提供了枚举客域、创建新客域和管理现有域的方法。客域由 virDomainPtr 对象表示，并具有多个唯一标识符： 唯一标识符 ID：正整数，在一台主机上运行的客户域中是唯一的。非活动域没有 ID。如果主机操作系统是虚拟域，默认情况下 ID 为 0。例如，在 Xen 虚拟机">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-03-04T07:50:26.000Z">
<meta property="article:modified_time" content="2025-03-15T08:00:27.746Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="云计算">
<meta property="article:tag" content="libvirt">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="https://watsonlu6.github.io/libvirt%E6%96%87%E6%A1%A3/4-libvirt%E5%AE%A2%E6%88%B7%E5%9F%9FDomain/index.html">
  
    <link rel="alternate" href="/atom.xml" title="watson&#39;blogs" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 7.3.0"></head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/watsonLu6/" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">watson</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">Cloud computing development engineer</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> BeiJing, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav ">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">标签</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">项目</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">关于</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/watsonLu6/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://weibo.com" target="_blank" title="Weibo" data-toggle=tooltip data-placement=top><i class="icon icon-weibo"></i></a></li>
        
        <li><a href="https://twitter.com" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
        <li><a href="https://www.behance.net" target="_blank" title="Behance" data-toggle=tooltip data-placement=top><i class="icon icon-behance"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>欢迎交流与分享经验!</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E7%94%9F%E6%B4%BB/">个人生活</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%91%E5%AD%98%E5%82%A8/">云存储</a><span class="category-list-count">29</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%91%E5%AD%98%E5%82%A8/Ceph/">Ceph</a><span class="category-list-count">24</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%91%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8%E5%9F%BA%E7%A1%80/">存储基础</a><span class="category-list-count">5</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a><span class="category-list-count">12</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/libvirt/">libvirt</a><span class="category-list-count">12</span></li></ul></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ceph/" rel="tag">Ceph</a><span class="tag-list-count">24</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/libvirt/" rel="tag">libvirt</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AA%E4%BA%BA%E7%94%9F%E6%B4%BB/" rel="tag">个人生活</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%91%E5%AD%98%E5%82%A8/" rel="tag">云存储</a><span class="tag-list-count">29</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" rel="tag">云计算</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%98%E5%82%A8%E5%9F%BA%E7%A1%80/" rel="tag">存储基础</a><span class="tag-list-count">5</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签云</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/Ceph/" style="font-size: 13.75px;">Ceph</a> <a href="/tags/libvirt/" style="font-size: 13.5px;">libvirt</a> <a href="/tags/%E4%B8%AA%E4%BA%BA%E7%94%9F%E6%B4%BB/" style="font-size: 13px;">个人生活</a> <a href="/tags/%E4%BA%91%E5%AD%98%E5%82%A8/" style="font-size: 14px;">云存储</a> <a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" style="font-size: 13.5px;">云计算</a> <a href="/tags/%E5%AD%98%E5%82%A8%E5%9F%BA%E7%A1%80/" style="font-size: 13.25px;">存储基础</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">三月 2024</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">十月 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">九月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">八月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">二月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">十一月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">七月 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a><span class="archive-list-count">5</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a><i class="icon icon-angle-right"></i><a class="category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/libvirt/">libvirt</a>
              </p>
              <p class="item-title">
                <a href="/libvirt%E6%96%87%E6%A1%A3/12-libvirt%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B/" class="title">12 libvirt使用示例</a>
              </p>
              <p class="item-date">
                <time datetime="2024-03-12T07:50:26.000Z" itemprop="datePublished">2024-03-12</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a><i class="icon icon-angle-right"></i><a class="category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/libvirt/">libvirt</a>
              </p>
              <p class="item-title">
                <a href="/libvirt%E6%96%87%E6%A1%A3/11-libvirt%E8%B0%83%E8%AF%95%E4%B8%8E%E6%97%A5%E5%BF%97/" class="title">11 libvirt调试与日志</a>
              </p>
              <p class="item-date">
                <time datetime="2024-03-11T07:50:26.000Z" itemprop="datePublished">2024-03-11</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a><i class="icon icon-angle-right"></i><a class="category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/libvirt/">libvirt</a>
              </p>
              <p class="item-title">
                <a href="/libvirt%E6%96%87%E6%A1%A3/10-libvirt%E5%AE%89%E5%85%A8%E6%A8%A1%E5%BC%8F/" class="title">10 libvirt安全模式</a>
              </p>
              <p class="item-date">
                <time datetime="2024-03-10T07:50:26.000Z" itemprop="datePublished">2024-03-10</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a><i class="icon icon-angle-right"></i><a class="category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/libvirt/">libvirt</a>
              </p>
              <p class="item-title">
                <a href="/libvirt%E6%96%87%E6%A1%A3/9-libvirt%E4%BA%8B%E4%BB%B6%E5%92%8C%E8%AE%A1%E6%97%B6%E5%99%A8%E5%A4%84%E7%90%86/" class="title">9 libvirt事件和计时器处理</a>
              </p>
              <p class="item-date">
                <time datetime="2024-03-09T07:50:26.000Z" itemprop="datePublished">2024-03-09</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a><i class="icon icon-angle-right"></i><a class="category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/libvirt/">libvirt</a>
              </p>
              <p class="item-title">
                <a href="/libvirt%E6%96%87%E6%A1%A3/8-libvirt%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/" class="title">8 libvirt错误处理</a>
              </p>
              <p class="item-date">
                <time datetime="2024-03-08T07:50:26.000Z" itemprop="datePublished">2024-03-08</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<main class="main" role="main">
  <div class="content">
  <article id="post-libvirt文档/4-libvirt客户域Domain" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      4 libvirt客户域Domain
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/libvirt%E6%96%87%E6%A1%A3/4-libvirt%E5%AE%A2%E6%88%B7%E5%9F%9FDomain/" class="article-date">
	  <time datetime="2024-03-04T07:50:26.000Z" itemprop="datePublished">2024-03-04</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a>►<a class="article-category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/libvirt/">libvirt</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/libvirt/" rel="tag">libvirt</a>, <a class="article-tag-link-link" href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" rel="tag">云计算</a>
  </span>


        

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/libvirt%E6%96%87%E6%A1%A3/4-libvirt%E5%AE%A2%E6%88%B7%E5%9F%9FDomain/#comments" class="article-comment-link">评论</a></span>
        
      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h1 id="4-1-Domain-概述"><a href="#4-1-Domain-概述" class="headerlink" title="4.1 Domain 概述"></a>4.1 Domain 概述</h1><p>域是运行在虚拟化机器上的操作系统实例。一个客域可以指正在运行的虚拟机或可用于启动虚拟机的配置。连接对象提供了枚举客域、创建新客域和管理现有域的方法。客域由 <code>virDomainPtr</code> 对象表示，并具有多个唯一标识符：</p>
<h2 id="唯一标识符"><a href="#唯一标识符" class="headerlink" title="唯一标识符"></a>唯一标识符</h2><ul>
<li><p><strong>ID</strong>：正整数，在一台主机上运行的客户域中是唯一的。非活动域没有 ID。如果主机操作系统是虚拟域，默认情况下 ID 为 0。例如，在 Xen 虚拟机管理程序中，<strong>Dom0</strong> 表示访客域。其他域 ID 将从 1 开始分配，每次启动新域时都会递增。通常情况下，在整个 ID 空间被包围之前，域 ID 不会被重复使用。域 ID 空间的大小至少为 16 位，但通常会扩展到 32 位。</p>
</li>
<li><p><strong>name</strong>：短字符串，在一台主机上的所有客户域（包括运行中和非活动域）中都是唯一的。为了在不同管理程序之间实现最大的可移植性，应用程序只能在名称中使用 <strong>a-Z、0-9、-、_</strong> 字符。许多管理程序会根据域名将非活动域配置作为文件存储在磁盘上。</p>
</li>
<li><p><strong>UUID</strong>：16 个无符号字节，保证在任何主机上的所有客户域中都是唯一的。RFC 4122 定义了 UUID 的格式，并提供了生成具有唯一性的 UUID 的推荐算法。如果主机操作系统本身就是一个虚拟域，那么按照惯例，它将获得一个全为 0 的 UUID。Xen 虚拟机管理程序就是这种情况，其中 <strong>Dom0</strong> 本身就是一个客户域。</p>
</li>
</ul>
<p>客户域可以是短暂的，也可以是持久的。瞬时访客域只能在主机上运行时进行管理，关闭电源后，所有痕迹都会消失。持久客户域的配置由管理程序以实施定义的格式保存在主机上的数据存储中。因此，当持久客户机关闭电源时，仍可管理其非活动配置。通过为临时客户机定义配置，可以将其快速转变为持久客户机。</p>
<p>当应用程序获得域的唯一标识符后，通常会希望获取相应的 <strong>virDomain</strong> 对象。有三种方法可用于查找现有域，它们的名字很有想象力，分别是 <strong>lookupByID</strong>、<strong>lookupByName</strong> 和 <strong>lookupByUUID</strong>。每个方法都将域标识符作为参数。如果没有匹配的域存在，它们将返回 <strong>None</strong>。如果需要，可以查询错误对象，以查找错误的具体细节。</p>
<h3 id="例-4-1-从-ID-获取域对象"><a href="#例-4-1-从-ID-获取域对象" class="headerlink" title="例 4.1. 从 ID 获取域对象"></a>例 4.1. 从 ID 获取域对象</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-1.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">domainID = <span class="number">6</span></span><br><span class="line">dom = conn.lookupByID(domainID)</span><br><span class="line"><span class="keyword">if</span> dom == <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Failed to get the domain object&#x27;</span>, file=sys.stderr)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>需要注意的是，如果域未激活，<strong>lookupByID</strong> 方法将不起作用。非活动域的 ID 都是 <strong>-1</strong>。</p>
<h3 id="例-4-2-从名称中获取域对象"><a href="#例-4-2-从名称中获取域对象" class="headerlink" title="例 4.2. 从名称中获取域对象"></a>例 4.2. 从名称中获取域对象</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-2.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">domainName = <span class="string">&#x27;someguest&#x27;</span></span><br><span class="line">dom = conn.lookupByName(domainName)</span><br><span class="line"><span class="keyword">if</span> dom == <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Failed to get the domain object&#x27;</span>, file=sys.stderr)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="例-4-3-从-UUID-获取域对象"><a href="#例-4-3-从-UUID-获取域对象" class="headerlink" title="例 4.3. 从 UUID 获取域对象"></a>例 4.3. 从 UUID 获取域对象</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-3.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">domainUUID = <span class="string">&quot;00311636-7767-71d2-e94a-26e7b8bad250&quot;</span></span><br><span class="line">dom = conn.lookupByUUID(domainUUID)</span><br><span class="line"><span class="keyword">if</span> dom == <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Failed to get the domain object&#x27;</span>, file=sys.stderr)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>上面的 UUID 示例使用的是 UUID 的可打印格式。Python 不支持使用等价的原始字节。</p>
<h1 id="列举-Domains"><a href="#列举-Domains" class="headerlink" title="列举 Domains"></a>列举 Domains</h1><p>libvirt 类公开了两个域列表，第一个列表包含运行中的域，第二个列表包含非活动的持久域。这两个列表是互不重叠的排他性集合，但在每个集合的查询过程中，域停止或启动的可能性很小。本节后面描述的事件类提供了一种跟踪所有生命周期变化的方法，可以避免这种潜在的竞赛条件。</p>
<p>该方法用于列出活动域，返回域 ID 列表。每个运行中的域都有一个正整数 ID，在主机上所有运行中的域中唯一标识。列出活动域的方法 <strong>listDomainsID</strong> 不需要任何参数。如果出错，返回值将是 <strong>None</strong>，或者是以 <strong>ints</strong> 表示的 ID 的 Python 列表。</p>
<h3 id="例-4-4-列出活动域"><a href="#例-4-4-列出活动域" class="headerlink" title="例 4.4. 列出活动域"></a>例 4.4. 列出活动域</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-4.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">domainIDs = conn.listDomainsID()</span><br><span class="line"><span class="keyword">if</span> domainIDs == <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Failed to get a list of domain IDs&#x27;</span>, file=sys.stderr)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Active domain IDs:&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(domainIDs) == <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;None&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">for</span> domainID <span class="keyword">in</span> domainIDs:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27; &#x27;</span> + <span class="built_in">str</span>(domainID))</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>除了运行中的域外，主机上还可能存储有一些持久的非活动域配置。由于非活动域没有任何 ID 标识符，因此非活动域列表将以名称字符串列表的形式显示。如果出错，返回值将是 <strong>None</strong>，或者是一个由名称（字符串）填充的 Python 元素列表。</p>
<h3 id="例-4-5-列出非活动域"><a href="#例-4-5-列出非活动域" class="headerlink" title="例 4.5. 列出非活动域"></a>例 4.5. 列出非活动域</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-5.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">domainNames = conn.listDefinedDomains()</span><br><span class="line"><span class="keyword">if</span> domainNames == <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Failed to get a list of domain names&#x27;</span>, file=sys.stderr)</span><br><span class="line"></span><br><span class="line">domainIDs = conn.listDomainsID()</span><br><span class="line"><span class="keyword">if</span> domainIDs == <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Failed to get a list of domain IDs&#x27;</span>, file=sys.stderr)</span><br><span class="line"></span><br><span class="line">domainNames = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(domainIDs) != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">for</span> domainID <span class="keyword">in</span> domainIDs:</span><br><span class="line">            domain = conn.lookupByID(domainID)</span><br><span class="line">            domainNames.append(domain.name)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    conn.close()</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;All (active and inactive domain names:&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(domainNames) == <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;none&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">for</span> domainName <span class="keyword">in</span> domainNames:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27; &#x27;</span> + domainName)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>列出域的方法不会直接返回 <strong>virDomain</strong> 对象，因为这可能会给希望频繁查询域列表的应用程序带来不必要的性能损失。不过，Python libvirt 模块提供了 <strong>listAllDomains</strong> 方法，该方法可列出所有活动或非活动域。该方法会返回一个 <strong>virDomain</strong> 实例的 Python 列表，如果出错则返回 <strong>None</strong>。当没有持久域存在时，列表可能为空。</p>
<h3 id="例-4-6-获取所有域对象"><a href="#例-4-6-获取所有域对象" class="headerlink" title="例 4.6. 获取所有域对象"></a>例 4.6. 获取所有域对象</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-6.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;All (active and inactive) domain names:&quot;</span>)</span><br><span class="line">domains = conn.listAllDomains(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(domains) != <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">for</span> domain <span class="keyword">in</span> domains:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27; &#x27;</span> + domain.name())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;None&quot;</span>)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h1 id="4-3-获取域名的状态信息"><a href="#4-3-获取域名的状态信息" class="headerlink" title="4.3 获取域名的状态信息"></a>4.3 获取域名的状态信息</h1><p>获得域实例后，就可以获取有关域状态的信息。这些信息包括托管的操作系统类型、运行状态、ID、UUID 等。以下方法将演示如何获取这些信息。</p>
<h2 id="获取域的-ID"><a href="#获取域的-ID" class="headerlink" title="获取域的 ID"></a>获取域的 ID</h2><p>使用 <strong>ID</strong> 方法可以获取域的 ID。只有运行中的域才有 ID，获取非运行中域的 ID 总是返回 <strong>-1</strong>。</p>
<h3 id="例-4-7-获取域的-ID"><a href="#例-4-7-获取域的-ID" class="headerlink" title="例 4.7. 获取域的 ID"></a>例 4.7. 获取域的 ID</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-43.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"><span class="keyword">from</span> xml.dom <span class="keyword">import</span> minidom</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Cent0S7&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    dom = conn.lookupByName(domName)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">id</span> = dom.ID()</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">id</span> == -<span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The domain is not running so has no ID.&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The ID of the domain is &#x27;</span> + <span class="built_in">str</span>(<span class="built_in">id</span>))</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="获取域的-UUID"><a href="#获取域的-UUID" class="headerlink" title="获取域的 UUID"></a>获取域的 UUID</h2><p>域的 UUID 可以通过 <strong>UUID</strong> 或 <strong>UUIDString</strong> 方法获得。<strong>UUID</strong> 方法对 Python 程序并不十分有用，因为它是一个二进制值。<strong>UUIDString 方法</strong>则有用得多，因为它返回的是一个格式化的字符串值，可以很容易地进行解析。</p>
<p>UUID 与域的运行状态无关，并始终返回一个有效的 UUID。</p>
<h3 id="例-4-8-获取域的-UUID"><a href="#例-4-8-获取域的-UUID" class="headerlink" title="例 4.8. 获取域的 UUID"></a>例 4.8. 获取域的 UUID</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-44.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"><span class="keyword">from</span> xml.dom <span class="keyword">import</span> minidom</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Cent0S7&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    dom = conn.lookupByName(domName)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">uuid = dom.UUIDString()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;The UUID of the domain is &#x27;</span> + uuid)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="获取域的操作系统类型"><a href="#获取域的操作系统类型" class="headerlink" title="获取域的操作系统类型"></a>获取域的操作系统类型</h2><p>域托管的操作系统类型也可用。只有运行中的域才有 ID，获取非运行中域的 ID 总是返回 <strong>-1</strong>。同样的信息也可以通过 <em>info</em> 方法获取。</p>
<h3 id="例-4-9-获取域的-ID"><a href="#例-4-9-获取域的-ID" class="headerlink" title="例 4.9. 获取域的 ID"></a>例 4.9. 获取域的 ID</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-45.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"><span class="keyword">from</span> xml.dom <span class="keyword">import</span> minidom</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Cent0S7&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    dom = conn.lookupByName(domName)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> = dom.OSType()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;The OS type of the domain is &quot;&#x27;</span> + <span class="built_in">type</span> + <span class="string">&#x27;&quot;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="确定域是否有当前快照"><a href="#确定域是否有当前快照" class="headerlink" title="确定域是否有当前快照"></a>确定域是否有当前快照</h2><p><strong>hasCurrentSnapshot</strong> 方法返回一个布尔值，表示当前快照是否可用。该方法始终返回有效值，且不依赖于域的运行状态。</p>
<h3 id="例-4-10-确定域是否有当前快照"><a href="#例-4-10-确定域是否有当前快照" class="headerlink" title="例 4.10. 确定域是否有当前快照"></a>例 4.10. 确定域是否有当前快照</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-47.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"><span class="keyword">from</span> xml.dom <span class="keyword">import</span> minidom</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Cent0S7&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    dom = conn.lookupByName(domName)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">flag = dom.hasCurrentSnapshot()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;The value of the current snapshot flag is &#x27;</span> + <span class="built_in">str</span>(flag))</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="确定域是否已管理保存镜像"><a href="#确定域是否已管理保存镜像" class="headerlink" title="确定域是否已管理保存镜像"></a>确定域是否已管理保存镜像</h2><p><strong>hasManagedSaveImages</strong> 方法返回一个布尔值，表示域是否有托管的保存镜像。请注意，运行中的域不应该有已保存的镜像，因为该镜像应在重启域时删除。</p>
<h3 id="例-4-11-确定域是否有托管保存镜像"><a href="#例-4-11-确定域是否有托管保存镜像" class="headerlink" title="例 4.11. 确定域是否有托管保存镜像"></a>例 4.11. 确定域是否有托管保存镜像</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-48.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"><span class="keyword">from</span> xml.dom <span class="keyword">import</span> minidom</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Cent0S7&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    dom = conn.lookupByName(domName)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">flag = dom.hasManagedSaveImage()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;The value of the managed save images flag is &#x27;</span> + <span class="built_in">str</span>(flag))</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="获取域名的主机名"><a href="#获取域名的主机名" class="headerlink" title="获取域名的主机名"></a>获取域名的主机名</h2><p><strong>hostname</strong> 方法返回域的主机名。</p>
<p><strong>hostname</strong> 方法高度依赖于管理程序和&#x2F;或 qemu-guest-agent。如果该方法无法成功完成，可能会出错。</p>
<h3 id="例-4-12-获取域的主机名"><a href="#例-4-12-获取域的主机名" class="headerlink" title="例 4.12. 获取域的主机名"></a>例 4.12. 获取域的主机名</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-49.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"><span class="keyword">from</span> xml.dom <span class="keyword">import</span> minidom</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Cent0S7&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    dom = conn.lookupByName(domName)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">name = dom.hostname()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;The hostname of the domain is &#x27;</span> + <span class="built_in">str</span>(name))</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="获取网域硬件信息"><a href="#获取网域硬件信息" class="headerlink" title="获取网域硬件信息"></a>获取网域硬件信息</h2><p><strong>info</strong> 方法会返回域硬件的一些常规信息。在 Python 列表中应返回八个条目，包括域的状态、最大内存、内存、cpus 和 cpu 时间。</p>
<h3 id="例-4-13-获取域名信息"><a href="#例-4-13-获取域名信息" class="headerlink" title="例 4.13. 获取域名信息"></a>例 4.13. 获取域名信息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-50.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"><span class="keyword">from</span> xml.dom <span class="keyword">import</span> minidom</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Cent0S7&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    dom = conn.lookupByName(domName)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">state, maxmem, mem, cpus, cput = dom.info()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;The state is &#x27;</span> + <span class="built_in">str</span>(state))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;The max memory is &#x27;</span> + <span class="built_in">str</span>(maxmem))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;The memory is &#x27;</span> + <span class="built_in">str</span>(mem))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;The number of cpus is &#x27;</span> + <span class="built_in">str</span>(cpus))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;The cpu time is &#x27;</span> + <span class="built_in">str</span>(cput))</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="确定网域是否正在运行"><a href="#确定网域是否正在运行" class="headerlink" title="确定网域是否正在运行"></a>确定网域是否正在运行</h2><p><strong>isActive</strong> 方法返回一个布尔标志，表示域是否处于活动（运行）状态。</p>
<h3 id="例-4-14-确定网域是否正在运行"><a href="#例-4-14-确定网域是否正在运行" class="headerlink" title="例 4.14. 确定网域是否正在运行"></a>例 4.14. 确定网域是否正在运行</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-51.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"><span class="keyword">from</span> xml.dom <span class="keyword">import</span> minidom</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Cent0S7&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    dom = conn.lookupByName(domName)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">flag = dom.isActive()</span><br><span class="line"><span class="keyword">if</span> flag == <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The domain is active.&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The domain is not active.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="确定网域是否具有持久性"><a href="#确定网域是否具有持久性" class="headerlink" title="确定网域是否具有持久性"></a>确定网域是否具有持久性</h2><p><strong>isPersistent</strong> 方法返回一个布尔标志，表示域是否持久（重启后域将持久）。</p>
<h3 id="例-4-15-确定域是否持久"><a href="#例-4-15-确定域是否持久" class="headerlink" title="例 4.15. 确定域是否持久"></a>例 4.15. 确定域是否持久</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-52.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"><span class="keyword">from</span> xml.dom <span class="keyword">import</span> minidom</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Cent0S7&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    dom = conn.lookupByName(domName)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">flag = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    flag = dom.isPersistent()</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    conn.close()</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> flag == <span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The domain is persistent.&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> flag == <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The domain is not persistent.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="确定网域是否已更新"><a href="#确定网域是否已更新" class="headerlink" title="确定网域是否已更新"></a>确定网域是否已更新</h2><p><strong>isUpdated</strong> 方法返回一个布尔标志，表示域自创建以来是否更新过。</p>
<h3 id="例-4-16-确定域是否已更新"><a href="#例-4-16-确定域是否已更新" class="headerlink" title="例 4.16. 确定域是否已更新"></a>例 4.16. 确定域是否已更新</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-58.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"><span class="keyword">from</span> xml.dom <span class="keyword">import</span> minidom</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Cent0S7&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    dom = conn.lookupByName(domName)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">flag = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    flag = dom.isUpdated()</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    conn.close()</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> flag == <span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The domain is updated.&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> flag == <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The domain is not updated.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="确定域的最大内存"><a href="#确定域的最大内存" class="headerlink" title="确定域的最大内存"></a>确定域的最大内存</h2><p><strong>maxMemory</strong> 方法返回分配给域的最大内存。</p>
<h3 id="例-4-17-确定域的最大内存"><a href="#例-4-17-确定域的最大内存" class="headerlink" title="例 4.17. 确定域的最大内存"></a>例 4.17. 确定域的最大内存</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-53.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"><span class="keyword">from</span> xml.dom <span class="keyword">import</span> minidom</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Cent0S7&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    dom = conn.lookupByName(domName)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">mem = dom.maxMemory()</span><br><span class="line"><span class="keyword">if</span> mem <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The max memory for domain is &#x27;</span> + <span class="built_in">str</span>(mem) + <span class="string">&#x27;MB&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;There was an error.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="确定网域的最大-Vcpus"><a href="#确定网域的最大-Vcpus" class="headerlink" title="确定网域的最大 Vcpus"></a>确定网域的最大 Vcpus</h2><p><strong>maxVcpus</strong> 方法返回分配给域的虚拟 CPU 的最大数量。</p>
<h3 id="例-4-18-确定域的最大-Vcpus"><a href="#例-4-18-确定域的最大-Vcpus" class="headerlink" title="例 4.18. 确定域的最大 Vcpus"></a>例 4.18. 确定域的最大 Vcpus</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-54.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"><span class="keyword">from</span> xml.dom <span class="keyword">import</span> minidom</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Cent0S7&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    dom = conn.lookupByName(domName)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">cpus = dom.maxVcpus()</span><br><span class="line"><span class="keyword">if</span> cpus != -<span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The max Vcpus for domain is &#x27;</span> + <span class="built_in">str</span>(cpus))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;There was an error.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="获取网域名称"><a href="#获取网域名称" class="headerlink" title="获取网域名称"></a>获取网域名称</h2><p><strong>name</strong> 方法返回域名的名称。</p>
<h3 id="例-4-19-获取网域名称"><a href="#例-4-19-获取网域名称" class="headerlink" title="例 4.19. 获取网域名称"></a>例 4.19. 获取网域名称</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-55.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"><span class="keyword">from</span> xml.dom <span class="keyword">import</span> minidom</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Cent0S7&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    dom = conn.lookupByName(domName)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">name = dom.name()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;The name of the domain is &quot;&#x27;</span> + name + <span class="string">&#x27;&quot;.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="获取域的状态"><a href="#获取域的状态" class="headerlink" title="获取域的状态"></a>获取域的状态</h2><p><strong>状态</strong> 方法返回域的状态。</p>
<h3 id="例-4-20-获取域的状态"><a href="#例-4-20-获取域的状态" class="headerlink" title="例 4.20. 获取域的状态"></a>例 4.20. 获取域的状态</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-56.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"><span class="keyword">from</span> xml.dom <span class="keyword">import</span> minidom</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Cent0S7&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    dom = conn.lookupByName(domName)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">state, reason = dom.state()</span><br><span class="line"><span class="keyword">if</span> state == libvirt.VIR_DOMAIN_NOSTATE:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The state is VIR_DOMAIN_NOSTATE&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> state == libvirt.VIR_DOMAIN_RUNNING:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The state is VIR_DOMAIN_RUNNING&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> state == libvirt.VIR_DOMAIN_BLOCKED:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The state is VIR_DOMAIN_BLOCKED&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> state == libvirt.VIR_DOMAIN_PAUSED:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The state is VIR_DOMAIN_PAUSED&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> state == libvirt.VIR_DOMAIN_SHUTDOWN:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The state is VIR_DOMAIN_SHUTDOWN&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> state == libvirt.VIR_DOMAIN_SHUTOFF:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The state is VIR_DOMAIN_SHUTOFF&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> state == libvirt.VIR_DOMAIN_CRASHED:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The state is VIR_DOMAIN_CRASHED&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> state == libvirt.VIR_DOMAIN_PMSUSPENDED:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The state is VIR_DOMAIN_PMSUSPENDED&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The state is unknown&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;The reason code is &#x27;</span> + <span class="built_in">str</span>(reason))</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="从域中提取时间信息"><a href="#从域中提取时间信息" class="headerlink" title="从域中提取时间信息"></a>从域中提取时间信息</h2><p><strong>getTime</strong> 方法从域中提取当前时间戳。该方法返回与 Python <strong>time.struct_time</strong> 函数相同的值。</p>
<h3 id="例-4-21-获取域的状态"><a href="#例-4-21-获取域的状态" class="headerlink" title="例 4.21. 获取域的状态"></a>例 4.21. 获取域的状态</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-57.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys, time</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"><span class="keyword">from</span> xml.dom <span class="keyword">import</span> minidom</span><br></pre></td></tr></table></figure>



<h1 id="抵御主机重启"><a href="#抵御主机重启" class="headerlink" title="抵御主机重启"></a>抵御主机重启</h1><p>抵御主机重启，而不会认为自己已经重启。libvirt 重启后，访客域将自动恢复。由于 libvirt 必须知道路径而无需用户输入，因此这将由独立于常规保存和还原的 API 来处理。</p>
<h3 id="例-4-34-为域设置自动启动"><a href="#例-4-34-为域设置自动启动" class="headerlink" title="例 4.34. 为域设置自动启动"></a>例 4.34. 为域设置自动启动</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-25.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Fedora22-x86_64-1&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = conn.lookupByID(<span class="number">6</span>)</span><br><span class="line"><span class="keyword">if</span> dom == <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Failed to find the domain &#x27;</span> + domName, file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom.setAutostart(<span class="number">1</span>)  <span class="comment"># 打开自动启动</span></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h1 id="网域配置"><a href="#网域配置" class="headerlink" title="网域配置"></a>网域配置</h1><p>libvirt 中使用 XML 定义域。与域相关的所有内容（如内存和 CPU）都在域 XML 中定义。域 XML 格式指定在 <a target="_blank" rel="noopener" href="http://libvirt.org/"><em>http://libvirt.org/</em></a> <em>formatdomain.html</em>。可在本地访问 <strong>&#x2F;usr&#x2F;share&#x2F;doc&#x2F;libvirt-devel-version&#x2F;</strong> 如果系统已安装 <em>libvirt-devel</em> 软件包。</p>
<p>访客域的配置信息可通过 <strong>XMLDesc</strong> 方法获取。该方法以 XML 数据流的形式返回域的当前描述。然后可以对该数据流进行解析，以获取有关域和构成域的所有部分的详细信息。</p>
<p>flags 参数可包含以下任意常数：</p>
<ul>
<li>VIR_DOMAIN_XML_SECURE</li>
<li>VIR_DOMAIN_XML_INACTIVE</li>
<li>VIR_DOMAIN_XML_UPDATE_CPU</li>
<li>VIR_DOMAIN_XML_MIGRATABLE</li>
</ul>
<h3 id="例-4-35-从域的-XML-描述中获取基本域信息"><a href="#例-4-35-从域的-XML-描述中获取基本域信息" class="headerlink" title="例 4.35. 从域的 XML 描述中获取基本域信息"></a>例 4.35. 从域的 XML 描述中获取基本域信息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-36.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"><span class="keyword">from</span> xml.dom <span class="keyword">import</span> minidom</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Fedora22-x86_64-1&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = conn.lookupByID(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">if</span> dom == <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Failed to find the domain &#x27;</span> + domName, file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">raw_xml = dom.XMLDesc(<span class="number">0</span>)</span><br><span class="line">xml = minidom.parseString(raw_xml)</span><br><span class="line">domainTypes = xml.getElementsByTagName(<span class="string">&#x27;type&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> domainType <span class="keyword">in</span> domainTypes:</span><br><span class="line">    <span class="built_in">print</span>(domainType.getAttribute(<span class="string">&#x27;machine&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(domainType.getAttribute(<span class="string">&#x27;arch&#x27;</span>))</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Emulator"><a href="#Emulator" class="headerlink" title="Emulator"></a>Emulator</h2><p>要发现访客域的模拟器，请查找并显示模拟器 XML 标记的内容。</p>
<h3 id="例-4-36-获取域的模拟器信息"><a href="#例-4-36-获取域的模拟器信息" class="headerlink" title="例 4.36. 获取域的模拟器信息"></a>例 4.36. 获取域的模拟器信息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-37.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"><span class="keyword">from</span> xml.dom <span class="keyword">import</span> minidom</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Fedora22-x86_64-1&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = conn.lookupByID(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">if</span> dom == <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Failed to find the domain &#x27;</span> + domName, file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">raw_xml = dom.XMLDesc(<span class="number">0</span>)</span><br><span class="line">xml = minidom.parseString(raw_xml)</span><br><span class="line">domainEmulator = xml.getElementsByTagName(<span class="string">&#x27;emulator&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;emulator: &#x27;</span> + domainEmulator[<span class="number">0</span>].firstChild.data)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>仿真器的 XML 配置通常如下：</p>
<h3 id="例-4-37-域仿真器-XML-信息"><a href="#例-4-37-域仿真器-XML-信息" class="headerlink" title="例 4.37. 域仿真器 XML 信息"></a>例 4.37. 域仿真器 XML 信息</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">domain</span> <span class="attr">type</span>=<span class="string">&#x27;kvm&#x27;</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">emulator</span>&gt;</span>/usr/libexec/qemu-kvm<span class="tag">&lt;/<span class="name">emulator</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">domain</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="启动模式"><a href="#启动模式" class="headerlink" title="启动模式"></a>启动模式</h2><p>通过 BIOS 启动适用于支持完全虚拟化的管理程序。在这种情况下，BIOS 有一个启动顺序优先级（软盘、硬盘、cdrom、网络），决定从哪里获取&#x2F;查找启动映像。</p>
<h3 id="例-4-38-设置启动模式"><a href="#例-4-38-设置启动模式" class="headerlink" title="例 4.38. 设置启动模式"></a>例 4.38. 设置启动模式</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">domain</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">os</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>HVM<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">loader</span> <span class="attr">readonly</span>=<span class="string">&#x27;yes&#x27;</span> <span class="attr">type</span>=<span class="string">&#x27;rom&#x27;</span>&gt;</span>/usr/lib/xen/boot/hvmloader<span class="tag">&lt;/<span class="name">loader</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">nvram</span> <span class="attr">template</span>=<span class="string">&#x27;/usr/share/OVMF/OVMF_VARS.fd&#x27;</span>&gt;</span>/var/lib/libvirt/nvram/guest_VARS.fd<span class="tag">&lt;/<span class="name">nvram</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">boot</span> <span class="attr">dev</span>=<span class="string">&#x27;hd&#x27;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">boot</span> <span class="attr">dev</span>=<span class="string">&#x27;cdrom&#x27;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bootmenu</span> <span class="attr">enable</span>=<span class="string">&#x27;yes&#x27;</span> <span class="attr">timeout</span>=<span class="string">&#x27;3000&#x27;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">smbios</span> <span class="attr">mode</span>=<span class="string">&#x27;sysinfo&#x27;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bios</span> <span class="attr">useserial</span>=<span class="string">&#x27;yes&#x27;</span> <span class="attr">rebootTimeout</span>=<span class="string">&#x27;0&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">os</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">domain</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="内存和-CPU-资源"><a href="#内存和-CPU-资源" class="headerlink" title="内存和 CPU 资源"></a>内存和 CPU 资源</h2><p>CPU 和内存资源可以在创建域时设置，也可以在域处于活动或非活动状态时动态设置。</p>
<p>CPU 资源是在创建域时使用 XML 定义中的标记设置的。管理程序定义了虚拟 CPU 的数量限制，无论是在创建域时还是以后都不能超过。这个最大值可能取决于许多资源和管理程序限制。下面是 CPU XML 规范的示例。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">domain</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">vcpu</span> <span class="attr">placement</span>=<span class="string">&#x27;static&#x27;</span> <span class="attr">cpuset</span>=<span class="string">&quot;1-4,^3,6&quot;</span> <span class="attr">current</span>=<span class="string">&quot;1&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">vcpu</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">domain</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>内存资源也可在创建域时使用 XML 定义中的标记进行设置。域的最大内存分配和当前内存分配都应设置。内存 XML 规范示例如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">domain</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">maxMemory</span> <span class="attr">slots</span>=<span class="string">&#x27;16&#x27;</span> <span class="attr">unit</span>=<span class="string">&#x27;KiB&#x27;</span>&gt;</span>1524288<span class="tag">&lt;/<span class="name">maxMemory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">memory</span> <span class="attr">unit</span>=<span class="string">&#x27;KiB&#x27;</span>&gt;</span>524288<span class="tag">&lt;/<span class="name">memory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">currentMemory</span> <span class="attr">unit</span>=<span class="string">&#x27;KiB&#x27;</span>&gt;</span>524288<span class="tag">&lt;/<span class="name">currentMemory</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">domain</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>域创建后，可通过 <strong>setVcpus</strong> 或 <strong>setVcpusFlags</strong> 方法增加虚拟 CPU 的数量。CPU 数量不得超过上文讨论的管理程序最大值。</p>
<h3 id="例-4-39-设置域的最大虚拟-CPU-数量"><a href="#例-4-39-设置域的最大虚拟-CPU-数量" class="headerlink" title="例 4.39. 设置域的最大虚拟 CPU 数量"></a>例 4.39. 设置域的最大虚拟 CPU 数量</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-29.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Fedora22-x86_64-1&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = conn.lookupByID(<span class="number">6</span>)</span><br><span class="line"><span class="keyword">if</span> dom == <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Failed to find the domain &#x27;</span> + domName, file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom.setVcpus(<span class="number">2</span>)</span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>创建域后，还可以通过 <strong>setMemory</strong> 或 <strong>setMemoryFlags</strong> 方法更改内存大小。内存大小应以千字节为单位。</p>
<h3 id="例-4-40-设置域的内存量"><a href="#例-4-40-设置域的内存量" class="headerlink" title="例 4.40. 设置域的内存量"></a>例 4.40. 设置域的内存量</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-30.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Fedora22-x86_64-1&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = conn.lookupByID(<span class="number">6</span>)</span><br><span class="line"><span class="keyword">if</span> dom == <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Failed to find the domain &#x27;</span> + domName, file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom.setMemory(<span class="number">4096</span>)  <span class="comment"># 4 GigaBytes</span></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>除了 <strong>setMemory</strong> 方法外，还有另一种方法 <strong>setMemoryFlags</strong>。</p>
<h1 id="监测性能"><a href="#监测性能" class="headerlink" title="监测性能"></a>监测性能</h1><p>统计指标可用于监控域、vCPU、内存、块设备和网络接口的利用率。</p>
<h2 id="域块设备性能"><a href="#域块设备性能" class="headerlink" title="域块设备性能"></a>域块设备性能</h2><p><strong>blockStats</strong> 方法提供了磁盘使用统计信息：</p>
<h3 id="例-4-41-获取磁盘块-I-O-统计信息"><a href="#例-4-41-获取磁盘块-I-O-统计信息" class="headerlink" title="例 4.41. 获取磁盘块 I&#x2F;O 统计信息"></a>例 4.41. 获取磁盘块 I&#x2F;O 统计信息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-31.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Fedora22-x86_64-1&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = conn.lookupByID(<span class="number">6</span>)</span><br><span class="line"><span class="keyword">if</span> dom == <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Failed to find the domain &#x27;</span> + domName, file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">rd_req, rd_bytes, wr_req, wr_bytes, err = dom.blockStats(<span class="string">&#x27;/path/to/linux-0.2.img&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Read requests issued: &#x27;</span> + <span class="built_in">str</span>(rd_req))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Bytes read: &#x27;</span> + <span class="built_in">str</span>(rd_bytes))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Write requests issued: &#x27;</span> + <span class="built_in">str</span>(wr_req))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;写入字节数: &#x27;</span> + <span class="built_in">str</span>(wr_bytes))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;错误次数: &#x27;</span> + <span class="built_in">str</span>(err))</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>返回的元组包含发出的读（写）请求数和实际传输的字节数。块设备由映像文件路径或域 XML 中的 devices&#x2F;disk&#x2F;target[@dev] 元素设置的设备总线名称指定。</p>
<p>除了 <strong>blockStats</strong> 方法外，还有 <strong>blockStatsFlags</strong> 备选方法。</p>
<h2 id="vCPU-性能"><a href="#vCPU-性能" class="headerlink" title="vCPU 性能"></a>vCPU 性能</h2><p>要获取单个 VCPU 统计数据，请使用 <strong>getCPUStats</strong> 方法。</p>
<h3 id="例-4-42-获取单个-CPU-统计数据"><a href="#例-4-42-获取单个-CPU-统计数据" class="headerlink" title="例 4.42. 获取单个 CPU 统计数据"></a>例 4.42. 获取单个 CPU 统计数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-33.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Fedora22-x86_64-1&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = conn.lookupByID(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">if</span> dom == <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Failed to find the domain &#x27;</span> + domName, file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">cpu_stats = dom.getCPUStats(<span class="literal">False</span>)</span><br><span class="line"><span class="keyword">for</span> (i, cpu) <span class="keyword">in</span> <span class="built_in">enumerate</span>(cpu_stats):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;CPU &#x27;</span> + <span class="built_in">str</span>(i) + <span class="string">&#x27; Time: &#x27;</span> + <span class="built_in">str</span>(cpu[<span class="string">&#x27;cpu_time&#x27;</span>] / <span class="number">1000000000.</span>))</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p><strong>getCPUStats</strong> 使用一个布尔参数。当使用 <strong>True</strong> 时，报告的统计数据是所有 CPU 的总和。如果使用 <strong>False</strong>，则每个 CPU 都会报告各自的统计数据。无论采用哪种方式，都会返回一个<strong>列表</strong>。统计数据以纳秒为单位报告。如果一台主机有四个 CPU，cpu_stats 列表中就会有四个条目。</p>
<p><strong>getCPUStats(True)</strong> 汇集主机上所有 CPU 的统计数据：</p>
<h3 id="例-4-43-获取-CPU-综合统计数据"><a href="#例-4-43-获取-CPU-综合统计数据" class="headerlink" title="例 4.43. 获取 CPU 综合统计数据"></a>例 4.43. 获取 CPU 综合统计数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-34.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Fedora22-x86_64-1&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = conn.lookupByID(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">if</span> dom == <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Failed to find the domain &#x27;</span> + domName, file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">stats = dom.getCPUStats(<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;cpu_time: &#x27;</span> + <span class="built_in">str</span>(stats[<span class="number">0</span>][<span class="string">&#x27;cpu_time&#x27;</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;system_time: &#x27;</span> + <span class="built_in">str</span>(stats[<span class="number">0</span>][<span class="string">&#x27;system_time&#x27;</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;user_time: &#x27;</span> + <span class="built_in">str</span>(stats[<span class="number">0</span>][<span class="string">&#x27;user_time&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="内存统计"><a href="#内存统计" class="headerlink" title="内存统计"></a>内存统计</h2><p>要获取域当前使用的内存量，可以使用 <strong>memoryStats</strong> 方法。</p>
<h3 id="例-4-44-获取内存统计信息"><a href="#例-4-44-获取内存统计信息" class="headerlink" title="例 4.44. 获取内存统计信息"></a>例 4.44. 获取内存统计信息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-35.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Fedora22-x86_64-1&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = conn.lookupByID(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">if</span> dom == <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Failed to find the domain &#x27;</span> + domName, file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">stats = dom.memoryStats()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;memory used:&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> stats:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27; &#x27;</span> + <span class="built_in">str</span>(stats[name]) + <span class="string">&#x27; (&#x27;</span> + name + <span class="string">&#x27;)&#x27;</span>)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>请注意，<strong>memoryStats</strong> 返回的是一个字典对象。根据管理程序和客户域的功能，该对象将包含数量不等的条目。</p>
<h2 id="网络-I-O-统计数据"><a href="#网络-I-O-统计数据" class="headerlink" title="网络 I&#x2F;O 统计数据"></a>网络 I&#x2F;O 统计数据</h2><p>要获取网络统计信息，需要域所连接主机接口的名称（通常为 vnetX）。要找到它，请检索域 XML 描述（libvirt 会在运行时修改它）。然后，查找 devices&#x2F;interface&#x2F;target[@dev] 元素：</p>
<h3 id="例-4-45-获取网络-I-O-统计信息"><a href="#例-4-45-获取网络-I-O-统计信息" class="headerlink" title="例 4.45. 获取网络 I&#x2F;O 统计信息"></a>例 4.45. 获取网络 I&#x2F;O 统计信息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-32.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"><span class="keyword">from</span> xml.etree <span class="keyword">import</span> ElementTree</span><br></pre></td></tr></table></figure>












<h1 id="监测性能-1"><a href="#监测性能-1" class="headerlink" title="监测性能"></a>监测性能</h1><p>统计指标可用于监控域、vCPU、内存、块设备和网络接口的利用率。</p>
<h2 id="域块设备性能-1"><a href="#域块设备性能-1" class="headerlink" title="域块设备性能"></a>域块设备性能</h2><p><strong>blockStats</strong> 方法提供了磁盘使用统计信息：</p>
<h3 id="例-4-41-获取磁盘块-I-O-统计信息-1"><a href="#例-4-41-获取磁盘块-I-O-统计信息-1" class="headerlink" title="例 4.41. 获取磁盘块 I&#x2F;O 统计信息"></a>例 4.41. 获取磁盘块 I&#x2F;O 统计信息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-31.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Fedora22-x86_64-1&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = conn.lookupByID(<span class="number">6</span>)</span><br><span class="line"><span class="keyword">if</span> dom == <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Failed to find the domain &#x27;</span> + domName, file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">rd_req, rd_bytes, wr_req, wr_bytes, err = dom.blockStats(<span class="string">&#x27;/path/to/linux-0.2.img&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Read requests issued: &#x27;</span> + <span class="built_in">str</span>(rd_req))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Bytes read: &#x27;</span> + <span class="built_in">str</span>(rd_bytes))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Write requests issued: &#x27;</span> + <span class="built_in">str</span>(wr_req))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;写入字节数: &#x27;</span> + <span class="built_in">str</span>(wr_bytes))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;错误次数: &#x27;</span> + <span class="built_in">str</span>(err))</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>返回的元组包含发出的读（写）请求数和实际传输的字节数。块设备由映像文件路径或域 XML 中的 <code>devices/disk/target[@dev]</code> 元素设置的设备总线名称指定。</p>
<p>除了 <strong>blockStats</strong> 方法外，还有 <strong>blockStatsFlags</strong> 备选方法。</p>
<h2 id="vCPU-性能-1"><a href="#vCPU-性能-1" class="headerlink" title="vCPU 性能"></a>vCPU 性能</h2><p>要获取单个 VCPU 统计数据，请使用 <strong>getCPUStats</strong> 方法。</p>
<h3 id="例-4-42-获取单个-CPU-统计数据-1"><a href="#例-4-42-获取单个-CPU-统计数据-1" class="headerlink" title="例 4.42. 获取单个 CPU 统计数据"></a>例 4.42. 获取单个 CPU 统计数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-33.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Fedora22-x86_64-1&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = conn.lookupByID(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">if</span> dom == <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Failed to find the domain &#x27;</span> + domName, file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">cpu_stats = dom.getCPUStats(<span class="literal">False</span>)</span><br><span class="line"><span class="keyword">for</span> (i, cpu) <span class="keyword">in</span> <span class="built_in">enumerate</span>(cpu_stats):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;CPU &#x27;</span> + <span class="built_in">str</span>(i) + <span class="string">&#x27; Time: &#x27;</span> + <span class="built_in">str</span>(cpu[<span class="string">&#x27;cpu_time&#x27;</span>] / <span class="number">1000000000.</span>))</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p><strong>getCPUStats</strong> 使用一个布尔参数。当使用 <strong>True</strong> 时，报告的统计数据是所有 CPU 的总和。如果使用 <strong>False</strong>，则每个 CPU 都会报告各自的统计数据。无论采用哪种方式，都会返回一个<strong>列表</strong>。统计数据以纳秒为单位报告。如果一台主机有四个 CPU，cpu_stats 列表中就会有四个条目。</p>
<p><strong>getCPUStats(True)</strong> 汇集主机上所有 CPU 的统计数据：</p>
<h3 id="例-4-43-获取-CPU-综合统计数据-1"><a href="#例-4-43-获取-CPU-综合统计数据-1" class="headerlink" title="例 4.43. 获取 CPU 综合统计数据"></a>例 4.43. 获取 CPU 综合统计数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-34.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Fedora22-x86_64-1&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = conn.lookupByID(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">if</span> dom == <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Failed to find the domain &#x27;</span> + domName, file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">stats = dom.getCPUStats(<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;cpu_time: &#x27;</span> + <span class="built_in">str</span>(stats[<span class="number">0</span>][<span class="string">&#x27;cpu_time&#x27;</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;system_time: &#x27;</span> + <span class="built_in">str</span>(stats[<span class="number">0</span>][<span class="string">&#x27;system_time&#x27;</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;user_time: &#x27;</span> + <span class="built_in">str</span>(stats[<span class="number">0</span>][<span class="string">&#x27;user_time&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="内存统计-1"><a href="#内存统计-1" class="headerlink" title="内存统计"></a>内存统计</h2><p>要获取域当前使用的内存量，可以使用 <strong>memoryStats</strong> 方法。</p>
<h3 id="例-4-44-获取内存统计信息-1"><a href="#例-4-44-获取内存统计信息-1" class="headerlink" title="例 4.44. 获取内存统计信息"></a>例 4.44. 获取内存统计信息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-35.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">domName = <span class="string">&#x27;Fedora22-x86_64-1&#x27;</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = conn.lookupByID(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">if</span> dom == <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Failed to find the domain &#x27;</span> + domName, file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">stats = dom.memoryStats()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;memory used:&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> stats:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27; &#x27;</span> + <span class="built_in">str</span>(stats[name]) + <span class="string">&#x27; (&#x27;</span> + name + <span class="string">&#x27;)&#x27;</span>)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>请注意，<strong>memoryStats</strong> 返回的是一个字典对象。根据管理程序和客户域的功能，该对象将包含数量不等的条目。</p>
<h2 id="网络-I-O-统计数据-1"><a href="#网络-I-O-统计数据-1" class="headerlink" title="网络 I&#x2F;O 统计数据"></a>网络 I&#x2F;O 统计数据</h2><p>要获取网络统计信息，需要域所连接主机接口的名称（通常为 vnetX）。要找到它，请检索域 XML 描述（libvirt 会在运行时修改它）。然后，查找 <code>devices/interface/target[@dev]</code> 元素：</p>
<h3 id="例-4-45-获取网络-I-O-统计信息-1"><a href="#例-4-45-获取网络-I-O-统计信息-1" class="headerlink" title="例 4.45. 获取网络 I&#x2F;O 统计信息"></a>例 4.45. 获取网络 I&#x2F;O 统计信息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-32.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"><span class="keyword">from</span> xml.etree <span class="keyword">import</span> ElementTree</span><br></pre></td></tr></table></figure>


<h1 id="PCI-设备直通"><a href="#PCI-设备直通" class="headerlink" title="PCI 设备直通"></a>PCI 设备直通</h1><p>PCI 设备直通功能可将主机中的物理 PCI 设备直接分配给客户机，客户机操作系统驱动程序可直接使用设备硬件，而无需依赖主机操作系统的任何驱动程序功能。</p>
<p>使用 PCI 设备直通时有一些注意事项。当 PCI 设备直接分配给客户机时，如果不先将设备从客户机热拔插，就无法进行迁移。此外，libvirt 并不保证直接分配设备是安全的，因此安全策略决定与底层虚拟化技术有关。安全 PCI 设备直通通常需要特殊的硬件功能，如英特尔芯片组的 VT-d 功能或 AMD 芯片组的 IOMMU。</p>
<p>连接 PCI 设备有两种模式：”托管” 或 “非托管” 模式，但在撰写本文时，只有 KVM 支持 “托管” 模式连接。在托管模式下，当客户机启动时，配置的设备将自动从主机操作系统驱动程序中分离，然后在客户机关闭时重新连接。在非托管模式下，必须在启动客户机之前明确分离设备。如果设备仍连接到主机操作系统，客户机将拒绝启动。libvirt 的 “节点设备” API 提供了从主机驱动程序分离&#x2F;重新连接 PCI 设备的方法。另外，也可以配置主机操作系统，将用于客户机的 PCI 设备列入黑名单，使其永远不会连接到主机操作系统驱动程序。</p>
<p>在这两种模式下，虚拟化技术始终会在启动客户机之前和客户机关闭之后对设备执行重置。这对于确保主机和客户操作系统之间的隔离至关重要。</p>
<p>复位 PCI 设备有多种方式。一些重置技术的范围仅限于单个设备&#x2F;功能，而另一些则可能同时影响多个设备。在后一种情况下，有必要将所有受影响的设备共同分配给同一客户，否则重置将不可能安全完成。节点设备 API 可用于确定设备是否需要共同分配，方法是手动分离设备，然后尝试执行重置操作。如果成功，就可以将设备单独分配给访客。如果失败，则需要将设备与同一 PCI 总线上的其他设备共同分配。</p>
<p>PCI 设备使用 “hostdevice” 元素连接到客户机。”模式” 属性应始终设置为 “子系统”，”类型” 属性应始终设置为 “pci”。”managed” 属性可根据应用需要设置为 “yes” 或 “no”。在 “hostdevice” 元素中有一个 “source” 元素，其中的 “address” 元素用于指定要连接的 PCI 设备。地址元素需要 “域”、”总线”、”插槽” 和 “功能” 属性。通过一个简短的示例最容易理解：</p>
<h3 id="例-4-52-获取域的输入设备信息"><a href="#例-4-52-获取域的输入设备信息" class="headerlink" title="例 4.52. 获取域的输入设备信息"></a>例 4.52. 获取域的输入设备信息</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">hostdev</span> <span class="attr">mode</span>=<span class="string">&#x27;subsystem&#x27;</span> <span class="attr">type</span>=<span class="string">&#x27;pci&#x27;</span> <span class="attr">managed</span>=<span class="string">&#x27;yes&#x27;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">address</span> <span class="attr">domain</span>=<span class="string">&#x27;0x0000&#x27;</span> <span class="attr">bus</span>=<span class="string">&#x27;0x06&#x27;</span> <span class="attr">slot</span>=<span class="string">&#x27;0x12&#x27;</span> <span class="attr">function</span>=<span class="string">&#x27;0x5&#x27;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hostdev</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="实时配置更改"><a href="#实时配置更改" class="headerlink" title="实时配置更改"></a>实时配置更改</h1><h2 id="区块设备工作"><a href="#区块设备工作" class="headerlink" title="区块设备工作"></a>区块设备工作</h2><p>Libvirt 提供了通用的块任务方法，可用于启动和管理对属于域的磁盘的操作。通过调用与所需的操作（如 <strong>blockPull</strong>）。一旦启动，所有区块任务都以相同的方式进行管理。它们可以被中止、节流和查询。完成后，会发出一个异步事件来指示最终状态。</p>
<p>可以启动以下程序块任务：</p>
<ul>
<li><strong>blockPull()</strong> 启动指定磁盘的块拉动操作。<strong>blockPull</strong> 会从磁盘的后备映像中提取数据填充磁盘映像。一旦从其后备映像中提取了所有数据，磁盘就不再依赖于后备映像。</li>
<li>可以使用 <strong>blockJobInfo</strong> 查询磁盘上的活动分块任务。如果找到，作业信息将以结构形式报告，其中包含：作业类型、带宽节流设置和进度信息。</li>
<li><strong>virDomainBlockJobAbort()</strong> 可用于取消指定磁盘上的活动块任务。使用 <strong>blockJobSetSpeed()</strong> 可以限制块任务可能消耗的带宽。</li>
</ul>
<p>带宽以 MB&#x2F;秒为单位指定。</p>
<h3 id="例-4-53-获取域的输入设备信息"><a href="#例-4-53-获取域的输入设备信息" class="headerlink" title="例 4.53. 获取域的输入设备信息"></a>例 4.53. 获取域的输入设备信息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example-40.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> libvirt</span><br><span class="line"></span><br><span class="line">domxml = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;domain type=&#x27;kvm&#x27;&gt;</span></span><br><span class="line"><span class="string">    &lt;name&gt;示例&lt;/name&gt;</span></span><br><span class="line"><span class="string">    &lt;memory&gt;131072&lt;/memory&gt;</span></span><br><span class="line"><span class="string">    &lt;vcpu&gt;1&lt;/vcpu&gt;</span></span><br><span class="line"><span class="string">    &lt;os&gt;</span></span><br><span class="line"><span class="string">        &lt;type arch=&#x27;x86_64&#x27; machine=&#x27;pc-0.13&#x27;&gt;hvm&lt;/type&gt;</span></span><br><span class="line"><span class="string">    &lt;/os&gt;</span></span><br><span class="line"><span class="string">    &lt;devices&gt;</span></span><br><span class="line"><span class="string">        &lt;disk type=&#x27;file&#x27; device=&#x27;disk&#x27;&gt;</span></span><br><span class="line"><span class="string">            &lt;driver name=&#x27;qemu&#x27; type=&#x27;qed&#x27;/&gt;</span></span><br><span class="line"><span class="string">            &lt;source file=&#x27;/var/lib/libvirt/images/example.qed&#x27;/&gt;</span></span><br><span class="line"><span class="string">            &lt;target dev=&#x27;vda&#x27; bus=&#x27;virtio&#x27;/&gt;</span></span><br><span class="line"><span class="string">        &lt;/disk&gt;</span></span><br><span class="line"><span class="string">    &lt;/devices&gt;</span></span><br><span class="line"><span class="string">&lt;/domain&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do_cmd</span>(<span class="params">cmdline</span>):</span><br><span class="line">    status = os.system(cmdline)</span><br><span class="line">    <span class="keyword">if</span> status &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> WEXITSTATUS(status)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_domain</span>(<span class="params">conn</span>):</span><br><span class="line">    do_cmd(<span class="string">&quot;qemu-img create -f raw /var/lib/libvirt/images/backing.qed 100M&quot;</span>)</span><br><span class="line">    do_cmd(<span class="string">&quot;qemu-img create -f qed -b /var/lib/libvirt/images/backing.qed &quot;</span> +</span><br><span class="line">           <span class="string">&quot;/var/lib/libvirt/images/example.qed&quot;</span>)</span><br><span class="line">    dom = conn.createXML(domxml, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> dom</span><br><span class="line"></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line">dom = <span class="literal">None</span></span><br><span class="line">disk = <span class="string">&quot;/var/lib/libvirt/images/example.qed&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = libvirt.<span class="built_in">open</span>(<span class="string">&quot;qemu:///system&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> libvirt.libvirtError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">repr</span>(e), file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">dom = make_domain(conn)</span><br><span class="line"><span class="keyword">if</span> dom == <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Failed to create domain&quot;</span>, file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> dom.blockPull(disk, <span class="number">0</span>, <span class="number">0</span>) &lt; <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Failed to start block pull&quot;</span>, file=sys.stderr)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>):</span><br><span class="line">    info = dom.blockJobInfo(disk, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> info != <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;BlockPull progress: %0.0f %%&quot;</span> % <span class="built_in">float</span>(<span class="number">100</span> * info.cur / info.end))</span><br><span class="line">    <span class="keyword">elif</span> info.cur == info.end:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;BlockPull complete&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Failed to query block jobs&quot;</span>, file=os.stderr)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">os.unlink(<span class="string">&quot;/var/lib/libvirt/images/backing.qed&quot;</span>)</span><br><span class="line">os.unlink(<span class="string">&quot;/var/lib/libvirt/images/example.qed&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> dom != <span class="literal">None</span>:</span><br><span class="line">    conn.destroy(dom)</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>




      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="https://watsonlu6.github.io/libvirt%E6%96%87%E6%A1%A3/4-libvirt%E5%AE%A2%E6%88%B7%E5%9F%9FDomain/" title="4 libvirt客户域Domain" target="_blank" rel="external">https://watsonlu6.github.io/libvirt文档/4-libvirt客户域Domain/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/watsonLu6/" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/watsonLu6/" target="_blank"><span class="text-dark">watson</span><small class="ml-1x">Cloud computing development engineer</small></a></h3>
        <div>内心要狂热，头脑要冷静，四肢要发达</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/libvirt%E6%96%87%E6%A1%A3/5-libvirt%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/" title="5 libvirt存储管理"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/libvirt%E6%96%87%E6%A1%A3/3-libvirt%E8%BF%9E%E6%8E%A5/" title="3 libvirt连接"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
  </ul>
  
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/watsonLu6/" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://weibo.com" target="_blank" title="Weibo" data-toggle=tooltip data-placement=top><i class="icon icon-weibo"></i></a></li>
        
        <li><a href="https://twitter.com" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
        <li><a href="https://www.behance.net" target="_blank" title="Behance" data-toggle=tooltip data-placement=top><i class="icon icon-behance"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   




   
    
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#vcomments',
    verify: false,
    notify: false,
    appId: '',
    appKey: '',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: meta,
    pageSize: '10' || 10,
    visitor: false
  });
  </script>

     







</body>
</html>